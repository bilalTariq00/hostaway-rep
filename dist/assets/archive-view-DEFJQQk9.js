import{D as Ce,r as c,j as e,B as u,T as o,a as x,a4 as w,e as l,d as h,C as z,I as E,P as De,bh as f}from"./index-DDMGUD-_.js";import{D as Te}from"./content-DAzX26cm.js";import{T as ke,a as T}from"./Tabs-DQ5TNJO7.js";import{G as y}from"./Grid-CFM_c-Vf.js";import{F as I}from"./FormControl-BRgYzLHi.js";import{I as $}from"./InputLabel-B_w9HMQG.js";import{S as F}from"./Select-DixiLax7.js";import{T as Ae}from"./TableContainer-Cp4gnwML.js";import{T as Se,a as we,b as G,c as r,d as ze}from"./TableHead-CMCmgIDA.js";import{P as Ee}from"./Pagination-Dusx6Zp7.js";import{M as Ie}from"./Menu-Bm1ShPnp.js";import{D as U,a as H,b as Y,c as J}from"./DialogContent-CkHDAA-B.js";import{F as $e}from"./FormControlLabel-nlFIIXjS.js";import{C as Fe}from"./Checkbox-DrgNyHeB.js";import"./KeyboardArrowRight-D6UvfiY9.js";import"./LastPage-K8Xc1QT_.js";import"./SwitchBase-s8UEUZOy.js";function Qe(){const j=Ce(),[V,q]=c.useState(3),[M,K]=c.useState(1),[k]=c.useState(50),[B,P]=c.useState(null),[d,g]=c.useState(null),[Q,b]=c.useState(!1),[X,C]=c.useState(!1),[Z,ee]=c.useState(""),[se,te]=c.useState(""),[re,ie]=c.useState(""),[L,A]=c.useState([]),[O,W]=c.useState(null),[D,ne]=c.useState({});c.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("authToken");if(!t)return;const n=await fetch(`${f}/api/users?status=active`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(n.ok){const a=await n.json();if(a.success&&a.data){const p={};a.data.forEach(m=>{p[m.id]=m}),ne(p)}}}catch(t){console.error("Error fetching users:",t)}})()},[]);const[i,S]=c.useState({task:!0,description:!0,status:!0,priority:!0,assignee:!0,supervisor:!0,group:!0,startDate:!0,endDate:!0,category:!0,listing:!0,channel:!0,reservation:!0,cost:!0,customFields:!0,archivedDate:!0});c.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("authToken");if(!t)return;const n=await fetch(`${f}/api/tasks?isArchived=true&limit=1000`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(n.ok){const a=await n.json();a.success&&a.data&&A(a.data)}}catch(t){console.error("Error fetching archived tasks:",t)}})()},[]);const ae=(s,t)=>{q(t),t===0&&j.push("/tasks/manage-tasks"),t===1&&j.push("/tasks/manage-auto-tasks"),t===2&&j.push("/tasks/checklist-templates")},oe=(s,t)=>{P(s.currentTarget),g(t)},v=()=>{P(null),g(null)},le=()=>{j.push("/tasks/new")},ce=()=>{d&&j.push(`/tasks/${d._id||d.id}/view`),v()},de=()=>{d&&j.push(`/tasks/${d.id}/edit`),v()},he=()=>{C(!0),v()},ue=()=>{d&&j.push(`/tasks/${d._id||d.id}/duplicate`),C(!1),g(null)},R=()=>{C(!1),g(null)},xe=async()=>{if(d){try{const s=localStorage.getItem("authToken");if(!s){alert("Not authenticated");return}const t=await fetch(`${f}/api/tasks/${d._id||d.id}/restore`,{method:"POST",headers:{Authorization:`Bearer ${s}`}});if(t.ok){const n=await fetch(`${f}/api/tasks?isArchived=true&limit=1000`,{method:"GET",headers:{Authorization:`Bearer ${s}`}});if(n.ok){const a=await n.json();a.success&&a.data&&A(a.data)}}else{const n=await t.json();alert(n.message||"Failed to restore task")}}catch(s){console.error("Error restoring task:",s),alert("Failed to restore task")}v()}},je=()=>{b(!0),v()},pe=async()=>{if(d){if(!confirm("Are you sure you want to permanently delete this task?")){b(!1);return}try{const s=localStorage.getItem("authToken");if(!s){alert("Not authenticated");return}const t=await fetch(`${f}/api/tasks/${d._id||d.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(t.ok){const n=await fetch(`${f}/api/tasks?isArchived=true&limit=1000`,{method:"GET",headers:{Authorization:`Bearer ${s}`}});if(n.ok){const a=await n.json();a.success&&a.data&&A(a.data)}}else{const n=await t.json();alert(n.message||"Failed to delete task")}}catch(s){console.error("Error deleting task:",s),alert("Failed to delete task")}b(!1),g(null)}},me=s=>{W(s.currentTarget)},ge=()=>{W(null)},ve=s=>{S(t=>({...t,[s]:!t[s]}))},_=()=>{b(!1),g(null)},fe=Math.ceil(L.length/k),N=(M-1)*k,ye=N+k,be=L.slice(N,ye);return e.jsxs(Te,{maxWidth:"xl",children:[e.jsxs(u,{sx:{mb:3},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:600},children:"Tasks"}),e.jsx(x,{variant:"contained",onClick:le,children:"Add Tasks"})]}),e.jsxs(ke,{value:V,onChange:ae,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:500},"& .Mui-selected":{color:"primary.main",fontWeight:600},"& .MuiTabs-indicator":{bgcolor:"primary.main"}},children:[e.jsx(T,{label:"Manage Tasks"}),e.jsx(T,{label:"Manage Auto-tasks"}),e.jsx(T,{label:"Checklist Templates"}),e.jsx(T,{label:"Archive"})]})]}),e.jsx(w,{sx:{p:2,mb:3},children:e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(y,{size:{xs:12,sm:6,md:3},children:e.jsxs(I,{fullWidth:!0,size:"small",children:[e.jsx($,{children:"Listing"}),e.jsxs(F,{value:Z,label:"Listing",onChange:s=>ee(s.target.value),children:[e.jsx(l,{value:"",children:"All Listings"}),e.jsx(l,{value:"old-villa",children:"Old Villa"}),e.jsx(l,{value:"old-apartment",children:"Old Apartment"}),e.jsx(l,{value:"old-property",children:"Old Property"})]})]})}),e.jsx(y,{size:{xs:12,sm:6,md:3},children:e.jsxs(I,{fullWidth:!0,size:"small",children:[e.jsx($,{children:"Channel"}),e.jsxs(F,{value:se,label:"Channel",onChange:s=>te(s.target.value),children:[e.jsx(l,{value:"",children:"All Channels"}),e.jsx(l,{value:"airbnb",children:"Airbnb"}),e.jsx(l,{value:"booking",children:"Booking.com"}),e.jsx(l,{value:"direct",children:"Direct"})]})]})}),e.jsx(y,{size:{xs:12,sm:6,md:3},children:e.jsxs(I,{fullWidth:!0,size:"small",children:[e.jsx($,{children:"Assignee"}),e.jsxs(F,{value:re,label:"Assignee",onChange:s=>ie(s.target.value),children:[e.jsx(l,{value:"",children:"All Assignees"}),e.jsx(l,{value:"john",children:"John Doe"}),e.jsx(l,{value:"mike",children:"Mike Johnson"}),e.jsx(l,{value:"tom",children:"Tom Brown"})]})]})}),e.jsx(y,{size:{xs:12,sm:6,md:3},children:e.jsx(x,{variant:"outlined",startIcon:e.jsx(h,{icon:"eva:more-horizontal-fill"}),fullWidth:!0,children:"More Filter"})})]})}),e.jsxs(w,{sx:{mb:3},children:[e.jsxs(u,{sx:{p:2,borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"h6",children:"Tasks Table"}),e.jsx(x,{variant:"outlined",size:"small",startIcon:e.jsx(h,{icon:"eva:settings-fill"}),onClick:me,children:"Column Settings"})]}),e.jsx(Ae,{children:e.jsxs(Se,{children:[e.jsx(we,{children:e.jsxs(G,{children:[i.task&&e.jsx(r,{children:"Task"}),i.description&&e.jsx(r,{children:"Description"}),i.status&&e.jsx(r,{children:"Status"}),i.priority&&e.jsx(r,{children:"Priority"}),i.assignee&&e.jsx(r,{children:"Assignee"}),i.supervisor&&e.jsx(r,{children:"Supervisor"}),i.group&&e.jsx(r,{children:"Group"}),i.startDate&&e.jsx(r,{children:"Start Date"}),i.endDate&&e.jsx(r,{children:"End Date"}),i.category&&e.jsx(r,{children:"Category"}),i.listing&&e.jsx(r,{children:"Listing"}),i.channel&&e.jsx(r,{children:"Channel"}),i.reservation&&e.jsx(r,{children:"Reservation"}),i.cost&&e.jsx(r,{children:"Cost"}),i.customFields&&e.jsx(r,{children:"Custom Fields"}),i.archivedDate&&e.jsx(r,{children:"Archived Date"}),e.jsx(r,{align:"center",children:"Actions"})]})}),e.jsx(ze,{children:be.map(s=>e.jsxs(G,{children:[i.task&&e.jsx(r,{children:e.jsx(o,{variant:"body2",sx:{fontWeight:500},children:s.title||"Untitled Task"})}),i.description&&e.jsx(r,{children:e.jsx(o,{variant:"body2",color:"text.secondary",children:s.description||"-"})}),i.status&&e.jsx(r,{children:e.jsx(z,{label:s.status||"Pending",size:"small",color:"default"})}),i.priority&&e.jsx(r,{children:e.jsx(z,{label:s.priority||"Medium",size:"small",color:s.priority==="High"?"error":s.priority==="Medium"?"warning":"success"})}),i.assignee&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:(()=>{var a,p,m;const t=typeof s.assignee=="object"&&((a=s.assignee)!=null&&a._id)?s.assignee._id.toString():((p=s.assignee)==null?void 0:p.toString())||"";return(typeof s.assignee=="object"&&((m=s.assignee)!=null&&m.name)?s.assignee.name:t&&D[t]?D[t].name:null)||t||"-"})()})}),i.supervisor&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:(()=>{var a,p,m;const t=typeof s.supervisor=="object"&&((a=s.supervisor)!=null&&a._id)?s.supervisor._id.toString():((p=s.supervisor)==null?void 0:p.toString())||"";return(typeof s.supervisor=="object"&&((m=s.supervisor)!=null&&m.name)?s.supervisor.name:t&&D[t]?D[t].name:null)||t||"-"})()})}),i.group&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.group||"-"})}),i.startDate&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.startDate||"-"})}),i.endDate&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.endDate||"-"})}),i.category&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.category||"-"})}),i.listing&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.listing||"-"})}),i.channel&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.channel||"-"})}),i.reservation&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.reservation||"-"})}),i.cost&&e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.cost?`$${s.cost}`:"-"})}),i.customFields&&e.jsx(r,{children:e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.customFields&&Array.isArray(s.customFields)&&s.customFields.length>0?s.customFields.map((t,n)=>e.jsx(z,{label:`${t.name}: ${t.type==="boolean"?t.value?"Yes":"No":t.type==="date"?t.value?new Date(t.value).toLocaleDateString():"-":String(t.value||"-")}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:24}},n)):e.jsx(o,{variant:"caption",color:"text.secondary",children:"-"})})}),i.archivedDate&&e.jsx(r,{children:e.jsx(o,{variant:"body2",color:"text.secondary",children:s.archivedDate||"-"})}),e.jsx(r,{align:"center",children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(E,{size:"small",onClick:()=>j.push(`/tasks/${s.id}/view`),children:e.jsx(h,{icon:"eva:eye-fill",width:16})}),e.jsx(E,{size:"small",onClick:()=>{g(s),C(!0)},children:e.jsx(h,{icon:"eva:copy-fill",width:16})}),e.jsx(E,{size:"small",onClick:t=>oe(t,s),children:e.jsx(h,{icon:"eva:more-vertical-fill",width:16})})]})})]},s.id))})]})})]}),e.jsx(w,{sx:{p:2},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(o,{variant:"body2",color:"text.secondary",children:"Show 50 per page"}),e.jsx(Ee,{count:fe,page:M,onChange:(s,t)=>K(t),color:"primary"})]})}),e.jsxs(Ie,{anchorEl:B,open:!!B,onClose:v,children:[e.jsxs(l,{onClick:ce,children:[e.jsx(h,{icon:"eva:eye-fill",sx:{mr:1}}),"View Details"]}),e.jsxs(l,{onClick:de,children:[e.jsx(h,{icon:"eva:edit-fill",sx:{mr:1}}),"Edit"]}),e.jsxs(l,{onClick:he,children:[e.jsx(h,{icon:"eva:copy-fill",sx:{mr:1}}),"Duplicate"]}),e.jsxs(l,{onClick:xe,children:[e.jsx(h,{icon:"eva:refresh-fill",sx:{mr:1}}),"Restore"]}),e.jsxs(l,{onClick:je,sx:{color:"error.main"},children:[e.jsx(h,{icon:"eva:trash-2-fill",sx:{mr:1}}),"Delete Permanently"]})]}),e.jsxs(U,{open:X,onClose:R,children:[e.jsx(H,{children:"Duplicate?"}),e.jsx(Y,{children:e.jsx(o,{children:'Are you sure you want to duplicate this task? This will create a copy with "(Copy)" added to the title.'})}),e.jsxs(J,{children:[e.jsx(x,{onClick:R,children:"No"}),e.jsx(x,{onClick:ue,variant:"contained",children:"Yes"})]})]}),e.jsxs(U,{open:Q,onClose:_,children:[e.jsx(H,{children:"Delete?"}),e.jsx(Y,{children:e.jsx(o,{children:"Are you sure you want to permanently delete this task? This action cannot be undone."})}),e.jsxs(J,{children:[e.jsx(x,{onClick:_,children:"No"}),e.jsx(x,{onClick:pe,color:"error",variant:"contained",children:"Yes"})]})]}),e.jsx(De,{open:!!O,anchorEl:O,onClose:ge,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(u,{sx:{p:2,minWidth:250},children:[e.jsx(o,{variant:"h6",sx:{mb:2},children:"Show/Hide Columns"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Select which columns to display in the table"}),e.jsx(u,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:300,overflowY:"auto"},children:Object.entries(i).map(([s,t])=>{const n={task:"Task Title",description:"Description",status:"Status",priority:"Priority",assignee:"Assignee",supervisor:"Supervisor",group:"Group",startDate:"Start Date",endDate:"End Date",category:"Category",listing:"Listing",channel:"Channel",reservation:"Reservation",cost:"Cost",archivedDate:"Archived Date"};return e.jsx($e,{control:e.jsx(Fe,{checked:t,onChange:()=>ve(s),size:"small"}),label:n[s]||s,sx:{"& .MuiFormControlLabel-label":{fontSize:"0.875rem"}}},s)})}),e.jsxs(u,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(x,{size:"small",onClick:()=>{S({task:!0,description:!0,status:!0,priority:!0,assignee:!0,supervisor:!0,group:!0,startDate:!0,endDate:!0,category:!0,listing:!0,channel:!0,reservation:!0,cost:!0,customFields:!0,archivedDate:!0})},children:"Show All"}),e.jsx(x,{size:"small",onClick:()=>{S({task:!0,description:!1,status:!0,priority:!0,assignee:!0,supervisor:!1,group:!1,startDate:!1,endDate:!1,category:!1,listing:!0,channel:!0,reservation:!1,cost:!1,customFields:!0,archivedDate:!1})},sx:{ml:1},children:"Show Essential"})]})]})})]})}export{Qe as ArchiveView};
