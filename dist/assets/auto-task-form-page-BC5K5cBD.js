import{a3 as ae,G as ie,r as x,j as e,B as n,a as g,T as o,e as a,I as f,a5 as L,x as ne,bh as C}from"./index-DDMGUD-_.js";import{D as le}from"./content-DAzX26cm.js";import{A as re}from"./arrow-left-DVLbOZnK.js";import{S as oe}from"./save-D0sLAz8V.js";import{T as j}from"./TextField-BZcg-6kp.js";import{F as h}from"./FormControl-BRgYzLHi.js";import{S as u}from"./Select-DixiLax7.js";import{I as m}from"./InputLabel-B_w9HMQG.js";import{P as ce}from"./plus-0dYUhXY5.js";import{S as H}from"./Switch-CS1Ni3s3.js";import{I as de}from"./info-_UHBnIlD.js";import{C as he}from"./Card-C1fEEBVz.js";import{C as ue}from"./CardContent-Bmb6KKQR.js";import{C as I}from"./Checkbox-DrgNyHeB.js";import{F as _}from"./FormControlLabel-nlFIIXjS.js";import"./Menu-Bm1ShPnp.js";import"./SwitchBase-s8UEUZOy.js";const O=[{id:"305034",name:"La Dimora Del Cavaliere",image:"/assets/images/listing1.jpg"},{id:"305035",name:"Navigli",image:"/assets/images/listing2.jpg"},{id:"305225",name:"Polacchi42",image:"/assets/images/listing3.jpg"},{id:"305421",name:"Superattico - Via Del Corso 43",image:"/assets/images/listing4.jpg"},{id:"306532",name:"Montecatini Terme",image:"/assets/images/listing5.jpg"},{id:"308582",name:"Monteverde - Quattroventi",image:"/assets/images/listing6.jpg"},{id:"310867",name:"La Storta",image:"/assets/images/listing7.jpg"},{id:"317154",name:"[5 Min From Trastevere] Chic Apt",image:"/assets/images/listing8.jpg"},{id:"332386",name:"Via Poggio Tulliano",image:"/assets/images/listing9.jpg"},{id:"363365",name:"Via di Acqua Bullicante 113",image:"/assets/images/listing10.jpg"},{id:"345603",name:"Via Dei Marruccini | San Lorenzo",image:"/assets/images/listing11.jpg"},{id:"363366",name:"Via Matera 23A",image:"/assets/images/listing12.jpg"}];function Ie(){const{id:v}=ae(),w=ie(),b=!!v,y=window.location.pathname.includes("/duplicate");x.useEffect(()=>{(async()=>{var l,c,d,z,F,V,R,G,N,$;if(!(!v||!b&&!y))try{const T=localStorage.getItem("authToken");if(!T)return;const P=await fetch(`${C}/api/auto-tasks/${v}`,{method:"GET",headers:{Authorization:`Bearer ${T}`}});if(P.ok){const S=await P.json();if(S.success&&S.data){const i=S.data;k({title:i.name||"",event:i.startingEvent||"Check-in",startsAtValue:i.startsAtValue||0,startsAtUnit:i.startsAtUnit||"Hours",startsAtTiming:i.startsAtTiming||"At",startsAtEvent:i.startsAtEvent||i.startingEvent||"Check-in",shouldEndByValue:i.shouldEndByValue||0,shouldEndByUnit:i.shouldEndByUnit||"Hours",shouldEndByTiming:i.shouldEndByTiming||"At",shouldEndByEvent:i.shouldEndByEvent||"Check-out",description:i.description||"",checklistTemplate:((c=(l=i.checklistTemplateId)==null?void 0:l._id)==null?void 0:c.toString())||((d=i.checklistTemplateId)==null?void 0:d.toString())||"",attachments:i.attachments||[],addAutomaticallyNewListings:i.addAutomaticallyNewListings||!1,active:i.status==="Active",assignee:((F=(z=i.assignee)==null?void 0:z._id)==null?void 0:F.toString())||((V=i.assignee)==null?void 0:V.toString())||"",supervisor:((G=(R=i.supervisor)==null?void 0:R._id)==null?void 0:G.toString())||((N=i.supervisor)==null?void 0:N.toString())||"",group:i.group||"",category:i.category||"",channel:i.linkedChannel||"",cost:(($=i.cost)==null?void 0:$.toString())||"",costCurrency:i.costCurrency||"USD",costDescription:i.costDescription||"",autoGenerateExpense:i.autoGenerateExpense||!1,createTasksForExistingReservations:i.createTasksForExistingReservations!==!1,selectedListings:Array.isArray(i.linkedListings)?i.linkedListings.map(p=>{var M;return typeof p=="string"?p:((M=p._id)==null?void 0:M.toString())||p.toString()}):i.linkedListing?[i.linkedListing]:[]}),y&&k(p=>({...p,title:`${p.title} (Copy)`}))}}}catch(T){console.error("Error fetching auto-task:",T)}})()},[v,b,y]);const[t,k]=x.useState({title:"",event:"Check-in",startsAtValue:0,startsAtUnit:"Hours",startsAtTiming:"At",startsAtEvent:"Check-in",shouldEndByValue:0,shouldEndByUnit:"Hours",shouldEndByTiming:"At",shouldEndByEvent:"Check-out",description:"",checklistTemplate:"",attachments:[],addAutomaticallyNewListings:!1,active:!1,assignee:"",supervisor:"",group:"",category:"",channel:"",cost:"",costCurrency:"USD",costDescription:"",autoGenerateExpense:!1,createTasksForExistingReservations:!0,selectedListings:[]}),[W,J]=x.useState(""),[q,Q]=x.useState([]),[D,X]=x.useState([]),[E,A]=x.useState(!1),[Y,K]=x.useState([]),[U,B]=x.useState(!1);x.useEffect(()=>{(async()=>{A(!0);try{const l=localStorage.getItem("authToken");if(!l){A(!1);return}const c=await fetch(`${C}/api/users?status=active`,{method:"GET",headers:{Authorization:`Bearer ${l}`}});if(c.ok){const d=await c.json();d.success&&d.data&&X(d.data)}}catch(l){console.error("Error fetching users:",l)}finally{A(!1)}})()},[]),x.useEffect(()=>{(async()=>{B(!0);try{const l=localStorage.getItem("authToken");if(!l){B(!1);return}const c=await fetch(`${C}/api/checklist-templates?limit=1000`,{method:"GET",headers:{Authorization:`Bearer ${l}`}});if(c.ok){const d=await c.json();d.success&&d.data&&K(d.data)}}catch(l){console.error("Error fetching checklist templates:",l)}finally{B(!1)}})()},[]);const r=(s,l)=>{k(c=>({...c,[s]:l}))},Z=s=>{k(l=>({...l,selectedListings:l.selectedListings.includes(s)?l.selectedListings.filter(c=>c!==s):[...l.selectedListings,s]}))},ee=()=>{const s=O.map(l=>l.id);k(l=>({...l,selectedListings:l.selectedListings.length===s.length?[]:s}))},se=async()=>{try{const s=localStorage.getItem("authToken");if(!s){alert("Not authenticated");return}const l={name:t.title,description:t.description||"",startingEvent:t.event,startsAtValue:t.startsAtValue||0,startsAtUnit:t.startsAtUnit||"Hours",startsAtTiming:t.startsAtTiming||"At",startsAtEvent:t.startsAtEvent||t.event,shouldEndByValue:t.shouldEndByValue||0,shouldEndByUnit:t.shouldEndByUnit||"Hours",shouldEndByTiming:t.shouldEndByTiming||"At",shouldEndByEvent:t.shouldEndByEvent||"Check-out",status:t.active?"Active":"Inactive",linkedChannel:t.channel||"",linkedListings:t.selectedListings||[],assignee:t.assignee||null,supervisor:t.supervisor||null,group:t.group||"",category:t.category||"",cost:t.cost?parseFloat(t.cost):null,costCurrency:t.costCurrency||"USD",costDescription:t.costDescription||"",autoGenerateExpense:t.autoGenerateExpense||!1,addAutomaticallyNewListings:t.addAutomaticallyNewListings||!1,createTasksForExistingReservations:t.createTasksForExistingReservations!==!1,checklistTemplateId:t.checklistTemplate||null};let c;if(b&&v?c=await fetch(`${C}/api/auto-tasks/${v}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(l)}):c=await fetch(`${C}/api/auto-tasks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(l)}),c.ok){const d=await c.json();d.success?w("/tasks/manage-auto-tasks"):alert(d.message||"Failed to save auto-task")}else{const d=await c.json().catch(()=>({message:"Failed to save auto-task"}));alert(d.message||"Failed to save auto-task")}}catch(s){console.error("Error saving auto-task:",s),alert("Failed to save auto-task. Please try again.")}},te=O.filter(s=>s.name.toLowerCase().includes(W.toLowerCase()));return e.jsxs(le,{maxWidth:"xl",children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(g,{startIcon:e.jsx(re,{size:16}),onClick:()=>w("/tasks/manage-auto-tasks"),children:"Back to auto-tasks"}),e.jsx(g,{variant:"contained",onClick:se,startIcon:e.jsx(oe,{size:16}),children:y?"Create Duplicate":b?"Update auto-task":"Save auto-task"})]}),e.jsxs(n,{sx:{display:"flex",gap:3},children:[e.jsxs(n,{sx:{flex:2},children:[e.jsx(j,{fullWidth:!0,label:"Task title",placeholder:"Task title",value:t.title,onChange:s=>r("title",s.target.value),sx:{mb:4},helperText:y?"This will create a new auto-task based on the original":""}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Schedule"}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(o,{variant:"body2",sx:{mb:1,fontWeight:500},children:"Event"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(h,{sx:{minWidth:200},children:e.jsxs(u,{value:t.event,onChange:s=>r("event",s.target.value),displayEmpty:!0,children:[e.jsx(a,{value:"Check-in",children:"Check-in"}),e.jsx(a,{value:"Check-out",children:"Check-out"}),e.jsx(a,{value:"Booking Confirmed",children:"Booking Confirmed"}),e.jsx(a,{value:"Issue Reported",children:"Issue Reported"})]})}),e.jsx(f,{size:"small",children:e.jsx(L,{size:16})}),e.jsx(f,{size:"small",children:e.jsx(o,{variant:"body2",children:"▼"})})]})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(o,{variant:"body2",sx:{mb:1,fontWeight:500},children:"Starts at"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(j,{type:"number",value:t.startsAtValue,onChange:s=>r("startsAtValue",parseInt(s.target.value)||0),sx:{width:80}}),e.jsx(n,{sx:{display:"flex",gap:.5},children:["Hours","Days"].map(s=>e.jsx(g,{variant:t.startsAtUnit===s?"contained":"outlined",size:"small",onClick:()=>r("startsAtUnit",s),sx:{minWidth:"auto",px:1},children:s},s))}),e.jsx(n,{sx:{display:"flex",gap:.5},children:["Before","At","After"].map(s=>e.jsx(g,{variant:t.startsAtTiming===s?"contained":"outlined",size:"small",onClick:()=>r("startsAtTiming",s),sx:{minWidth:"auto",px:1},children:s},s))}),e.jsx(h,{sx:{minWidth:150},children:e.jsxs(u,{value:t.startsAtEvent,onChange:s=>r("startsAtEvent",s.target.value),displayEmpty:!0,children:[e.jsx(a,{value:"Check-in",children:"Check-in"}),e.jsx(a,{value:"Check-out",children:"Check-out"}),e.jsx(a,{value:"Booking Confirmed",children:"Booking Confirmed"}),e.jsx(a,{value:"Issue Reported",children:"Issue Reported"})]})}),e.jsx(f,{size:"small",children:e.jsx(L,{size:16})}),e.jsx(f,{size:"small",children:e.jsx(o,{variant:"body2",children:"▼"})})]})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(o,{variant:"body2",sx:{mb:1,fontWeight:500},children:"Should end by"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(j,{type:"number",value:t.shouldEndByValue,onChange:s=>r("shouldEndByValue",parseInt(s.target.value)||0),sx:{width:80}}),e.jsx(n,{sx:{display:"flex",gap:.5},children:["Hours","Days"].map(s=>e.jsx(g,{variant:t.shouldEndByUnit===s?"contained":"outlined",size:"small",onClick:()=>r("shouldEndByUnit",s),sx:{minWidth:"auto",px:1},children:s},s))}),e.jsx(n,{sx:{display:"flex",gap:.5},children:["Before","At","After"].map(s=>e.jsx(g,{variant:t.shouldEndByTiming===s?"contained":"outlined",size:"small",onClick:()=>r("shouldEndByTiming",s),sx:{minWidth:"auto",px:1},children:s},s))}),e.jsx(h,{sx:{minWidth:150},children:e.jsxs(u,{value:t.shouldEndByEvent,onChange:s=>r("shouldEndByEvent",s.target.value),displayEmpty:!0,children:[e.jsx(a,{value:"Check-in",children:"Check-in"}),e.jsx(a,{value:"Check-out",children:"Check-out"}),e.jsx(a,{value:"Booking Confirmed",children:"Booking Confirmed"}),e.jsx(a,{value:"Issue Reported",children:"Issue Reported"})]})}),e.jsx(f,{size:"small",children:e.jsx(L,{size:16})}),e.jsx(f,{size:"small",children:e.jsx(o,{variant:"body2",children:"▼"})})]})]})]}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Details"}),e.jsx(j,{fullWidth:!0,multiline:!0,rows:4,label:"Description",placeholder:"Description",value:t.description,onChange:s=>r("description",s.target.value)})]}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Task checklist"}),e.jsxs(h,{fullWidth:!0,children:[e.jsx(m,{children:"Checklist template"}),e.jsxs(u,{value:t.checklistTemplate,label:"Checklist template",onChange:s=>r("checklistTemplate",s.target.value),disabled:U,children:[e.jsx(a,{value:"",children:e.jsx("em",{children:"None"})}),U?e.jsx(a,{disabled:!0,children:"Loading templates..."}):Y.map(s=>e.jsx(a,{value:s._id||s.id,children:s.name},s._id||s.id))]})]})]}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Attachments"}),e.jsx(g,{variant:"text",startIcon:e.jsx(ce,{size:16}),children:"ADD ATTACHMENT"})]}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Listing"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(H,{checked:t.addAutomaticallyNewListings,onChange:s=>r("addAutomaticallyNewListings",s.target.checked)}),e.jsx(o,{variant:"body2",children:"Add automatically new listings"}),e.jsx(ne,{title:"This will automatically add new listings to this auto-task",children:e.jsx(de,{size:16})})]}),e.jsx(j,{fullWidth:!0,placeholder:"Type to search listing...",value:W,onChange:s=>J(s.target.value),sx:{mb:2}}),e.jsxs(h,{fullWidth:!0,sx:{mb:2},children:[e.jsx(m,{children:"Select tags"}),e.jsxs(u,{multiple:!0,value:q,onChange:s=>Q(s.target.value),label:"Select tags",children:[e.jsx(a,{value:"luxury",children:"Luxury"}),e.jsx(a,{value:"budget",children:"Budget"}),e.jsx(a,{value:"family",children:"Family"}),e.jsx(a,{value:"business",children:"Business"})]})]}),e.jsx(g,{variant:"contained",onClick:ee,sx:{mb:2},children:"Select all"}),e.jsx(n,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:2},children:te.map(s=>e.jsx(he,{sx:{position:"relative"},children:e.jsx(ue,{sx:{p:2},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(n,{sx:{width:60,height:60,bgcolor:"grey.200",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(o,{variant:"caption",color:"text.secondary",children:"Image"})}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["(",s.id,")"]})]}),e.jsx(I,{checked:t.selectedListings.includes(s.id),onChange:()=>Z(s.id)})]})})},s.id))})]})]}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Active"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{checked:t.active,onChange:s=>r("active",s.target.checked)}),e.jsx(o,{variant:"body2",children:t.active?"Yes":"No"})]})]}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Users"}),e.jsxs(h,{fullWidth:!0,sx:{mb:2},children:[e.jsx(m,{children:"Assignee"}),e.jsxs(u,{value:t.assignee,label:"Assignee",onChange:s=>r("assignee",s.target.value),disabled:E,children:[e.jsx(a,{value:"",children:e.jsx("em",{children:"None"})}),E?e.jsx(a,{disabled:!0,children:"Loading users..."}):D.map(s=>e.jsxs(a,{value:s.id,children:[s.name," (",s.email,") - ",s.role]},s.id))]})]}),e.jsxs(h,{fullWidth:!0,sx:{mb:2},children:[e.jsx(m,{children:"Supervisor"}),e.jsxs(u,{value:t.supervisor,label:"Supervisor",onChange:s=>r("supervisor",s.target.value),disabled:E,children:[e.jsx(a,{value:"",children:e.jsx("em",{children:"None"})}),E?e.jsx(a,{disabled:!0,children:"Loading users..."}):D.filter(s=>["super-admin","manager","supervisor"].includes(s.role)).map(s=>e.jsxs(a,{value:s.id,children:[s.name," (",s.email,") - ",s.role]},s.id))]})]}),e.jsxs(h,{fullWidth:!0,children:[e.jsx(m,{children:"Group"}),e.jsxs(u,{value:t.group,label:"Group",onChange:s=>r("group",s.target.value),children:[e.jsx(a,{value:"User group",children:"User group"}),e.jsx(a,{value:"Cleaning Team",children:"Cleaning Team"}),e.jsx(a,{value:"Maintenance Team",children:"Maintenance Team"})]})]})]}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Link"}),e.jsxs(h,{fullWidth:!0,sx:{mb:2},children:[e.jsx(m,{children:"Category"}),e.jsxs(u,{value:t.category,label:"Category",onChange:s=>r("category",s.target.value),children:[e.jsx(a,{value:"",children:"Select Category"}),e.jsx(a,{value:"Maintenance",children:"Maintenance"}),e.jsx(a,{value:"Cleaning",children:"Cleaning"}),e.jsx(a,{value:"Inspection",children:"Inspection"}),e.jsx(a,{value:"Guest Service",children:"Guest Service"})]})]}),e.jsxs(h,{fullWidth:!0,children:[e.jsx(m,{children:"Channel"}),e.jsxs(u,{value:t.channel,label:"Channel",onChange:s=>r("channel",s.target.value),children:[e.jsx(a,{value:"Channel",children:"Channel"}),e.jsx(a,{value:"Airbnb",children:"Airbnb"}),e.jsx(a,{value:"Booking.com",children:"Booking.com"}),e.jsx(a,{value:"Direct",children:"Direct"})]})]})]}),e.jsxs(n,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Cost"}),e.jsx(j,{fullWidth:!0,label:"Cost",placeholder:"Cost",value:t.cost,onChange:s=>r("cost",s.target.value),sx:{mb:2}}),e.jsxs(h,{fullWidth:!0,sx:{mb:2},children:[e.jsx(m,{children:"Cost currency"}),e.jsxs(u,{value:t.costCurrency,label:"Cost currency",onChange:s=>r("costCurrency",s.target.value),children:[e.jsx(a,{value:"Cost currency",children:"Cost currency"}),e.jsx(a,{value:"USD",children:"USD"}),e.jsx(a,{value:"EUR",children:"EUR"}),e.jsx(a,{value:"GBP",children:"GBP"})]})]}),e.jsx(j,{fullWidth:!0,multiline:!0,rows:3,label:"Cost description",placeholder:"Cost description",value:t.costDescription,onChange:s=>r("costDescription",s.target.value),sx:{mb:2}}),e.jsx(_,{control:e.jsx(I,{checked:t.autoGenerateExpense,onChange:s=>r("autoGenerateExpense",s.target.checked)}),label:"Automatically generate an expense when the task is marked as done",sx:{mb:1}}),e.jsx(_,{control:e.jsx(I,{checked:t.createTasksForExistingReservations,onChange:s=>r("createTasksForExistingReservations",s.target.checked)}),label:"Create tasks from this auto-task for existing reservations"})]})]})]})]})}export{Ie as AutoTaskFormPage};
