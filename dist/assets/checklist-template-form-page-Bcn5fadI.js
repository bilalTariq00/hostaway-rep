import{D as F,a3 as W,bi as z,r as v,j as e,B as r,I as y,d as p,T as c,a as x,bh as u}from"./index-DDMGUD-_.js";import{D as B}from"./content-DAzX26cm.js";import{T as b}from"./TextField-BZcg-6kp.js";import{F as N}from"./FormControlLabel-nlFIIXjS.js";import{S as P}from"./Switch-CS1Ni3s3.js";import{D as O,a as R,b as L,c as J}from"./DialogContent-CkHDAA-B.js";import"./Select-DixiLax7.js";import"./Menu-Bm1ShPnp.js";import"./InputLabel-B_w9HMQG.js";import"./FormControl-BRgYzLHi.js";import"./SwitchBase-s8UEUZOy.js";function Z(){const k=F(),{id:o}=W(),C=z(),d=C.pathname.includes("/edit"),f=C.pathname.includes("/duplicate"),[l,h]=v.useState({name:"",description:"",tasks:[],active:!1}),[D,m]=v.useState(!1);v.useEffect(()=>{(async()=>{if(!(!o||!d&&!f))try{const a=localStorage.getItem("authToken");if(!a)return;const s=await fetch(`${u}/api/checklist-templates/${o}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(s.ok){const i=await s.json();if(i.success&&i.data){const n=i.data,T=Array.isArray(n.tasks)?n.tasks.map(j=>typeof j=="string"?j:j.item||""):[];d?h({name:n.name||"",description:n.description||"",tasks:T,active:n.isActive!==!1}):f&&h({name:`${n.name||""} (Copy)`,description:n.description||"",tasks:T,active:n.isActive!==!1})}}}catch(a){console.error("Error fetching checklist template:",a)}})()},[o,d,f]);const g=(t,a)=>{h(s=>({...s,[t]:a}))},A=()=>{h(t=>({...t,tasks:[...t.tasks,""]}))},w=(t,a)=>{h(s=>({...s,tasks:s.tasks.map((i,n)=>n===t?a:i)}))},E=t=>{h(a=>({...a,tasks:a.tasks.filter((s,i)=>i!==t)}))},I=async()=>{try{const t=localStorage.getItem("authToken");if(!t){alert("Not authenticated");return}const a={name:l.name,description:l.description||"",tasks:l.tasks.filter(i=>i.trim()!=="").map((i,n)=>({item:i,order:n})),isActive:l.active,category:""};let s;if(d&&o?s=await fetch(`${u}/api/checklist-templates/${o}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)}):s=await fetch(`${u}/api/checklist-templates`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)}),s.ok){const i=await s.json();i.success?k.push("/tasks/checklist-templates"):alert(i.message||"Failed to save template")}else{const i=await s.json().catch(()=>({message:"Failed to save template"}));alert(i.message||"Failed to save template")}}catch(t){console.error("Error saving checklist template:",t),alert("Failed to save template. Please try again.")}},S=async()=>{if(!o){m(!1);return}try{const t=localStorage.getItem("authToken");if(!t){alert("Not authenticated"),m(!1);return}const a=await fetch(`${u}/api/checklist-templates/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(a.ok)k.push("/tasks/checklist-templates");else{const s=await a.json();alert(s.message||"Failed to delete template")}}catch(t){console.error("Error deleting template:",t),alert("Failed to delete template")}m(!1)},$=()=>d?"Edit Checklist Template":f?"Duplicate Checklist Template":"Add Checklist Template";return e.jsxs(B,{maxWidth:"lg",children:[e.jsx(r,{sx:{mb:3},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(y,{onClick:()=>k.push("/tasks/checklist-templates"),children:e.jsx(p,{icon:"eva:arrow-back-fill"})}),e.jsx(c,{variant:"h4",sx:{fontWeight:600},children:$()})]}),e.jsx(x,{variant:"contained",onClick:I,disabled:!l.name.trim()||l.tasks.filter(t=>t.trim()!=="").length===0,children:"Save checklist template"})]})}),e.jsxs(r,{sx:{display:"flex",gap:3},children:[e.jsxs(r,{sx:{flex:1},children:[e.jsx(r,{sx:{mb:3},children:e.jsx(b,{fullWidth:!0,label:"Task title",value:l.name,onChange:t=>g("name",t.target.value),placeholder:"Enter checklist template name...",sx:{mb:2}})}),e.jsxs(r,{sx:{mb:3},children:[e.jsx(c,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Details"}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Description"}),e.jsx(b,{fullWidth:!0,multiline:!0,rows:4,value:l.description,onChange:t=>g("description",t.target.value),placeholder:"Enter description..."})]}),e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(c,{variant:"h6",sx:{fontWeight:600},children:"Checklist"}),e.jsx(x,{variant:"contained",size:"small",onClick:A,startIcon:e.jsx(p,{icon:"eva:plus-fill"}),children:"Add"})]}),l.tasks.map((t,a)=>e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(y,{size:"small",sx:{cursor:"grab"},children:e.jsx(p,{icon:"eva:menu-fill"})}),e.jsx(b,{fullWidth:!0,value:t,onChange:s=>w(a,s.target.value),placeholder:"Enter task...",size:"small"}),e.jsx(y,{size:"small",onClick:()=>E(a),sx:{color:"error.main"},children:e.jsx(p,{icon:"eva:trash-2-fill"})})]},a)),l.tasks.length===0&&e.jsx(c,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:'No tasks added yet. Click "Add" to create your first task.'})]})]}),e.jsxs(r,{sx:{width:300},children:[e.jsxs(r,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1},children:[e.jsx(c,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Active"}),e.jsx(N,{control:e.jsx(P,{checked:l.active,onChange:t=>g("active",t.target.checked)}),label:l.active?"Yes":"No"})]}),d&&e.jsx(r,{sx:{mt:2},children:e.jsx(x,{fullWidth:!0,variant:"outlined",color:"error",onClick:()=>m(!0),startIcon:e.jsx(p,{icon:"eva:trash-2-fill"}),children:"Delete Template"})})]})]}),e.jsxs(O,{open:D,onClose:()=>m(!1),children:[e.jsx(R,{children:"Delete?"}),e.jsx(L,{children:e.jsx(c,{children:"Are you sure you want to delete this checklist template? This action cannot be undone."})}),e.jsxs(J,{children:[e.jsx(x,{onClick:()=>m(!1),children:"No"}),e.jsx(x,{onClick:S,color:"error",variant:"contained",children:"Yes"})]})]})]})}export{Z as ChecklistTemplateFormPage};
