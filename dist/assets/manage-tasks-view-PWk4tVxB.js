import{D as ve,r as h,j as e,B as l,T as d,a as x,a4 as L,e as r,C as $,I as q,bh as A}from"./index-DDMGUD-_.js";import{D as ye}from"./content-DAzX26cm.js";import{T as be,a as k}from"./Tabs-DQ5TNJO7.js";import{F as f}from"./FormControl-BRgYzLHi.js";import{I as v}from"./InputLabel-B_w9HMQG.js";import{S as y}from"./Select-DixiLax7.js";import{E as Ce}from"./ellipsis-2U_Jz9Hu.js";import{C as Te}from"./Card-C1fEEBVz.js";import{C as De}from"./CardContent-Bmb6KKQR.js";import{T as Se}from"./TableContainer-Cp4gnwML.js";import{T as Ae,a as ke,b as W,c as a,d as We}from"./TableHead-CMCmgIDA.js";import{P as K}from"./pencil-Cjn288Y-.js";import{E as Me}from"./ellipsis-vertical-BBxk2nla.js";import{D as Q,a as X,b as Z,c as ee}from"./DialogContent-CkHDAA-B.js";import{T as se}from"./TextField-BZcg-6kp.js";import{M as Fe}from"./Menu-Bm1ShPnp.js";import{A as we}from"./archive-M3l3jVyX.js";import{T as Ie}from"./trash-2-C_X8cVKe.js";import"./KeyboardArrowRight-D6UvfiY9.js";function Xe(){const b=ve(),[te,re]=h.useState(0),[g,_]=h.useState(1),[C]=h.useState(50),[ie,N]=h.useState(!1),[O,R]=h.useState(null),[m,J]=h.useState(null),[ne,M]=h.useState(!1),[u,F]=h.useState(null),[i,U]=h.useState({listing:"",channel:"",assignee:"",supervisor:"",status:[],priority:[],fromDate:"",toDate:""}),[ae,w]=h.useState([]),[le,I]=h.useState(!0),[P,oe]=h.useState("dueDate"),[D,ce]=h.useState({});h.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("authToken");if(!t)return;const n=await fetch(`${A}/api/users?status=active`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(n.ok){const c=await n.json();if(c.success&&c.data){const o={};c.data.forEach(j=>{o[j.id]=j}),ce(o)}}}catch(t){console.error("Error fetching users:",t)}})()},[]),h.useEffect(()=>{(async()=>{I(!0);try{const t=localStorage.getItem("authToken");if(!t){I(!1);return}const n=new URLSearchParams({isArchived:"false",page:g.toString(),limit:C.toString(),sortBy:P,sortOrder:"asc"});i.status&&i.status.length>0&&i.status.forEach(o=>n.append("status",o)),i.priority&&i.priority.length>0&&i.priority.forEach(o=>n.append("priority",o)),i.assignee&&n.append("assignee",i.assignee),i.supervisor&&n.append("supervisor",i.supervisor),i.listing&&n.append("listing",i.listing),i.channel&&n.append("channel",i.channel),i.fromDate&&n.append("fromDate",i.fromDate),i.toDate&&n.append("toDate",i.toDate);const c=await fetch(`${A}/api/tasks?${n.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(c.ok){const o=await c.json();o.success&&o.data&&w(o.data)}}catch(t){console.error("Error fetching tasks:",t)}finally{I(!1)}})()},[g,C,P,i]);const de=(s,t)=>{re(t),t===1&&b.push("/tasks/manage-auto-tasks"),t===2&&b.push("/tasks/checklist-templates"),t===3&&b.push("/tasks/archive")},he=(s,t)=>{R(s.currentTarget),J(t)},S=()=>{R(null),J(null)},H=()=>{b.push("/tasks/new")},z=s=>{b.push(`/tasks/${s._id||s.id}/edit`)},xe=()=>{F(m),M(!0),S()},ue=async()=>{if(u)try{const s=localStorage.getItem("authToken");if(!s){alert("Not authenticated");return}const t=await fetch(`${A}/api/tasks/${u._id||u.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(t.ok)w(n=>n.filter(c=>(c._id||c.id)!==(u._id||u.id)));else{const n=await t.json();alert(n.message||"Failed to delete task")}}catch(s){console.error("Error deleting task:",s),alert("Failed to delete task")}M(!1),F(null)},G=()=>{M(!1),F(null)},pe=async()=>{if(m)try{const s=localStorage.getItem("authToken");if(!s){alert("Not authenticated"),S();return}const t=await fetch(`${A}/api/tasks/${m._id||m.id}/archive`,{method:"POST",headers:{Authorization:`Bearer ${s}`}});if(t.ok){const n=await t.json();n.success?(w(c=>c.filter(o=>(o._id||o.id)!==(m._id||m.id))),alert("Task archived successfully")):alert(n.message||"Failed to archive task")}else{const n=await t.json().catch(()=>({message:"Failed to archive task"}));alert(n.message||"Failed to archive task")}}catch(s){console.error("Error archiving task:",s),alert("Failed to archive task")}finally{S()}},p=(s,t)=>{U(n=>({...n,[s]:t}))},je=()=>{N(!0)},E=()=>{N(!1)},ge=()=>{E()},me=()=>{U({listing:"",channel:"",assignee:"",supervisor:"",status:[],priority:[],fromDate:"",toDate:""})},T=ae||[],fe=Math.ceil(T.length/C),B=(g-1)*C,V=B+C,Y=T.slice(B,V);return e.jsxs(ye,{maxWidth:"xl",children:[e.jsxs(l,{sx:{mb:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"h4",sx:{fontWeight:600},children:"Tasks"}),e.jsx(x,{variant:"contained",onClick:H,children:"Add Tasks"})]}),e.jsxs(be,{value:te,onChange:de,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:500},"& .Mui-selected":{color:"primary.main",fontWeight:600},"& .MuiTabs-indicator":{bgcolor:"primary.main"}},children:[e.jsx(k,{label:"Manage Tasks"}),e.jsx(k,{label:"Manage Auto-tasks"}),e.jsx(k,{label:"Checklist Templates"}),e.jsx(k,{label:"Archive"})]})]}),e.jsx(L,{sx:{p:2,mb:3},children:e.jsxs(l,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsxs(f,{fullWidth:!0,size:"small",children:[e.jsx(v,{children:"Listing"}),e.jsxs(y,{value:i.listing,label:"Listing",onChange:s=>p("listing",s.target.value),children:[e.jsx(r,{value:"",children:"All Listings"}),e.jsx(r,{value:"Villa Del Sol",children:"Villa Del Sol"}),e.jsx(r,{value:"Navigli Apartment",children:"Navigli Apartment"}),e.jsx(r,{value:"Polacchi42",children:"Polacchi42"})]})]})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsxs(f,{fullWidth:!0,size:"small",children:[e.jsx(v,{children:"Channel"}),e.jsxs(y,{value:i.channel,label:"Channel",onChange:s=>p("channel",s.target.value),children:[e.jsx(r,{value:"",children:"All Channels"}),e.jsx(r,{value:"Airbnb",children:"Airbnb"}),e.jsx(r,{value:"Booking.com",children:"Booking.com"}),e.jsx(r,{value:"Direct",children:"Direct"})]})]})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsxs(f,{fullWidth:!0,size:"small",children:[e.jsx(v,{children:"Assignee"}),e.jsxs(y,{value:i.assignee,label:"Assignee",onChange:s=>p("assignee",s.target.value),children:[e.jsx(r,{value:"",children:"All Assignees"}),e.jsx(r,{value:"John Doe",children:"John Doe"}),e.jsx(r,{value:"Mike Johnson",children:"Mike Johnson"}),e.jsx(r,{value:"Tom Brown",children:"Tom Brown"})]})]})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsxs(f,{fullWidth:!0,size:"small",children:[e.jsx(v,{children:"Supervisor"}),e.jsxs(y,{value:i.supervisor,label:"Supervisor",onChange:s=>p("supervisor",s.target.value),children:[e.jsx(r,{value:"",children:"All Supervisors"}),e.jsx(r,{value:"Jane Smith",children:"Jane Smith"}),e.jsx(r,{value:"Sarah Wilson",children:"Sarah Wilson"})]})]})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsxs(f,{fullWidth:!0,size:"small",children:[e.jsx(v,{children:"Sort Order"}),e.jsxs(y,{value:P,label:"Sort Order",onChange:s=>oe(s.target.value),children:[e.jsx(r,{value:"dueDate",children:"Due Date"}),e.jsx(r,{value:"priority",children:"Priority"}),e.jsx(r,{value:"status",children:"Status"}),e.jsx(r,{value:"createdAt",children:"Created Date"})]})]})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsx(x,{variant:"outlined",onClick:je,startIcon:e.jsx(Ce,{size:16}),fullWidth:!0,children:"More Filter"})})]})}),T.length===0?e.jsx(Te,{sx:{p:4,textAlign:"center",mb:3},children:e.jsxs(De,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,color:"text.secondary"},children:"No tasks found"}),e.jsx(d,{variant:"body2",sx:{mb:3,color:"text.secondary"},children:"Get started by creating your first task"}),e.jsx(x,{variant:"contained",onClick:H,children:"Add Task"})]})}):e.jsx(L,{sx:{mb:3},children:e.jsx(Se,{children:e.jsxs(Ae,{children:[e.jsx(ke,{children:e.jsxs(W,{children:[e.jsx(a,{children:"Task"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Priority"}),e.jsx(a,{children:"Assignee"}),e.jsx(a,{children:"Supervisor"}),e.jsx(a,{children:"Due Date"}),e.jsx(a,{children:"Channel"}),e.jsx(a,{children:"Listing"}),e.jsx(a,{children:"Custom Fields"}),e.jsx(a,{align:"center",children:"Actions"})]})}),e.jsx(We,{children:le?e.jsx(W,{children:e.jsx(a,{colSpan:10,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Loading tasks..."})})}):Y.length===0?e.jsx(W,{children:e.jsx(a,{colSpan:10,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"No tasks found"})})}):Y.map(s=>e.jsxs(W,{hover:!0,children:[e.jsx(a,{children:e.jsxs(l,{children:[e.jsx(d,{variant:"body2",sx:{fontWeight:500,cursor:"pointer",color:"primary.main"},onClick:()=>z(s),children:s.title}),e.jsx(d,{variant:"caption",color:"text.secondary",children:s.description})]})}),e.jsx(a,{children:e.jsx($,{label:s.status,size:"small",color:s.status==="Completed"?"success":s.status==="In Progress"?"warning":"default"})}),e.jsx(a,{children:e.jsx($,{label:s.priority,size:"small",color:s.priority==="High"?"error":s.priority==="Medium"?"warning":"success"})}),e.jsx(a,{children:e.jsx(d,{variant:"body2",children:(()=>{var c,o,j;const t=typeof s.assignee=="object"&&((c=s.assignee)!=null&&c._id)?s.assignee._id.toString():((o=s.assignee)==null?void 0:o.toString())||"";return(typeof s.assignee=="object"&&((j=s.assignee)!=null&&j.name)?s.assignee.name:t&&D[t]?D[t].name:null)||t||"-"})()})}),e.jsx(a,{children:e.jsx(d,{variant:"body2",children:(()=>{var c,o,j;const t=typeof s.supervisor=="object"&&((c=s.supervisor)!=null&&c._id)?s.supervisor._id.toString():((o=s.supervisor)==null?void 0:o.toString())||"";return(typeof s.supervisor=="object"&&((j=s.supervisor)!=null&&j.name)?s.supervisor.name:t&&D[t]?D[t].name:null)||t||"-"})()})}),e.jsx(a,{children:e.jsx(d,{variant:"body2",children:s.dueDate?new Date(s.dueDate).toLocaleDateString():s.dueDate||"-"})}),e.jsx(a,{children:e.jsx(d,{variant:"body2",children:s.channel})}),e.jsx(a,{children:e.jsx(d,{variant:"body2",children:s.listing})}),e.jsx(a,{children:e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.customFields&&Array.isArray(s.customFields)&&s.customFields.length>0?s.customFields.map((t,n)=>e.jsx($,{label:`${t.name}: ${t.type==="boolean"?t.value?"Yes":"No":t.type==="date"?t.value?new Date(t.value).toLocaleDateString():"-":String(t.value||"-")}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:24}},n)):e.jsx(d,{variant:"caption",color:"text.secondary",children:"-"})})}),e.jsx(a,{align:"center",children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(q,{size:"small",onClick:()=>z(s),sx:{"&:hover":{bgcolor:"primary.lighter"}},children:e.jsx(K,{size:16})}),e.jsx(q,{size:"small",onClick:t=>he(t,s),sx:{"&:hover":{bgcolor:"grey.100"}},children:e.jsx(Me,{size:16})})]})})]},s._id||s.id))})]})})}),e.jsx(L,{sx:{p:2},children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Show 50 per page"}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:[B+1,"-",Math.min(V,T.length)," of ",T.length]}),e.jsxs(l,{sx:{display:"flex",gap:.5},children:[e.jsx(x,{size:"small",disabled:g===1,onClick:()=>_(g-1),children:"Previous"}),e.jsx(x,{size:"small",disabled:g===fe,onClick:()=>_(g+1),children:"Next"})]})]})]})}),e.jsxs(Q,{open:ie,onClose:E,maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:"More Filters"}),e.jsx(Z,{children:e.jsxs(l,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:1},children:[e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsxs(f,{fullWidth:!0,children:[e.jsx(v,{children:"Status"}),e.jsxs(y,{label:"Status",multiple:!0,value:i.status,onChange:s=>p("status",s.target.value),children:[e.jsx(r,{value:"Pending",children:"Pending"}),e.jsx(r,{value:"In Progress",children:"In Progress"}),e.jsx(r,{value:"Completed",children:"Completed"})]})]})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsxs(f,{fullWidth:!0,children:[e.jsx(v,{children:"Priority"}),e.jsxs(y,{label:"Priority",multiple:!0,value:i.priority,onChange:s=>p("priority",s.target.value),children:[e.jsx(r,{value:"Low",children:"Low"}),e.jsx(r,{value:"Medium",children:"Medium"}),e.jsx(r,{value:"High",children:"High"})]})]})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsx(se,{fullWidth:!0,type:"date",label:"From Date",value:i.fromDate,onChange:s=>p("fromDate",s.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(l,{sx:{minWidth:200,flex:"1 1 200px"},children:e.jsx(se,{fullWidth:!0,type:"date",label:"To Date",value:i.toDate,onChange:s=>p("toDate",s.target.value),InputLabelProps:{shrink:!0}})})]})}),e.jsxs(ee,{children:[e.jsx(x,{onClick:me,children:"Reset Filters"}),e.jsx(x,{onClick:E,children:"Cancel"}),e.jsx(x,{variant:"contained",onClick:ge,children:"Apply Filters"})]})]}),e.jsxs(Fe,{anchorEl:O,open:!!O,onClose:S,children:[e.jsxs(r,{onClick:()=>z(m),children:[e.jsx(K,{size:16,style:{marginRight:8}}),"Edit"]}),e.jsxs(r,{onClick:pe,children:[e.jsx(we,{size:16,style:{marginRight:8}}),"Archive"]}),e.jsxs(r,{onClick:xe,sx:{color:"error.main"},children:[e.jsx(Ie,{size:16,style:{marginRight:8}}),"Delete"]})]}),e.jsxs(Q,{open:ne,onClose:G,children:[e.jsx(X,{children:"Delete Task"}),e.jsx(Z,{children:e.jsxs(d,{children:['Are you sure you want to delete "',u==null?void 0:u.title,'"? This action cannot be undone.']})}),e.jsxs(ee,{children:[e.jsx(x,{onClick:G,children:"Cancel"}),e.jsx(x,{onClick:ue,variant:"contained",color:"error",children:"Delete"})]})]})]})}export{Xe as ManageTasksView};
