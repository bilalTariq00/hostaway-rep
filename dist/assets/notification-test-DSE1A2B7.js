import{af as O,H as X,b0 as Z,r as l,bo as R,j as e,bp as L,B as n,T as t,a7 as y,bm as T,a as c,bq as W,C as Q,br as ee,bs as se,bt as ie,bu as te,bv as re,bw as ne}from"./index-DDMGUD-_.js";import{D as oe}from"./content-DAzX26cm.js";import{G as d}from"./Grid-CFM_c-Vf.js";import{C as g}from"./Card-C1fEEBVz.js";import{C as x}from"./CardContent-Bmb6KKQR.js";import{S as m}from"./Stack-B9BpzM62.js";import{C}from"./circle-x-CWYw6gZN.js";import{C as N}from"./CardHeader-BtOJpbTN.js";import{T as ae}from"./TextField-BZcg-6kp.js";import{S as ce}from"./send-DQcfXcnB.js";import"./Select-DixiLax7.js";import"./Menu-Bm1ShPnp.js";import"./InputLabel-B_w9HMQG.js";import"./FormControl-BRgYzLHi.js";function ke(){const o=O(),{user:a}=X(),{isPermissionGranted:j,requestPermission:le,sendMessageNotification:B,sendReminderNotification:F,sendPerformanceWarning:z,sendAdminWarning:M}=Z(),[h,I]=l.useState(null),[v,u]=l.useState("checking..."),[b,_]=l.useState("This is a test notification"),[E,$]=l.useState(!1),[P,r]=l.useState([]),[q,D]=l.useState(!1),[w,A]=l.useState(null);l.useEffect(()=>{const s="Notification"in window&&"serviceWorker"in navigator;$(s)},[]),l.useEffect(()=>{const s=R();I(s);const i=localStorage.getItem("notificationPermission");console.log("üîç [Test] Current permission:",Notification.permission),console.log("üîç [Test] Stored permission:",i),console.log("üîç [Test] FCM Token in storage:",s?"Found":"Not found"),console.log("üîç [Test] Environment check:"),console.log("  - VAPID_KEY:","Set"),console.log("  - API_KEY:","Set (using default or env)"),console.log("  - APP_ID:","Set (using default or env)")},[]),l.useEffect(()=>{(async()=>{if("serviceWorker"in navigator)try{const i=await navigator.serviceWorker.getRegistration();i?i.active?u("Active ‚úì"):i.installing?u("Installing..."):i.waiting&&u("Waiting..."):u("Not registered")}catch(i){u("Error: "+i.message)}else u("Not supported")})()},[]);const V=async()=>{try{console.log("üîî [Test] Requesting permission...");const s=await ee(),i=R();I(i);const p=localStorage.getItem("notificationPermission"),k=Notification.permission;r(k==="granted"?s&&s!=="browser-only"?f=>[...f,{type:"Permission",status:"success",message:`Notification permission granted! FCM Token received. (${s.substring(0,20)}...)`}]:s==="browser-only"?f=>[...f,{type:"Permission",status:"success",message:"Notification permission granted! Using browser notifications (FCM not configured - add API_KEY and APP_ID to .env.local for full FCM support)."}]:f=>[...f,{type:"Permission",status:"warning",message:"Notification permission granted, but FCM token not available. Browser notifications will work, but FCM push requires Firebase API_KEY, APP_ID, and VAPID_KEY in .env.local"}]:k==="denied"?f=>[...f,{type:"Permission",status:"error",message:"Permission denied. Please enable notifications in your browser settings and try again."}]:f=>[...f,{type:"Permission",status:"error",message:'Permission not granted. Please click "Allow" when prompted.'}])}catch(s){console.error("Error in handleRequestPermission:",s),r(i=>[...i,{type:"Permission",status:"error",message:`Error: ${s.message}`}])}},K=async()=>{if(!a){r(s=>[...s,{type:"Message Notification",status:"error",message:"User not logged in"}]);return}if(Notification.permission!=="granted"){r(s=>[...s,{type:"Message Notification",status:"error",message:`Permission not granted. Current status: ${Notification.permission}. Please click "Request Notification Permission" first.`}]);return}try{await B(a.id,"Test User",b,"test-conversation-1"),r(s=>[...s,{type:"Message Notification",status:"success",message:"Message notification sent successfully! Check if notification appears."}])}catch{r(i=>[...i,{type:"Message Notification",status:"error",message:"Failed to send notification. Check browser console for details."}])}},U=async()=>{if(!a){r(s=>[...s,{type:"Reminder Notification",status:"error",message:"User not logged in"}]);return}if(Notification.permission!=="granted"){r(s=>[...s,{type:"Reminder Notification",status:"error",message:`Permission not granted. Current status: ${Notification.permission}`}]);return}try{await F(a.id,"Test User","test-conversation-1"),r(s=>[...s,{type:"Reminder Notification",status:"success",message:"Reminder notification sent! Check if it appears (may be in system notification area or as in-page notification)."}])}catch{r(i=>[...i,{type:"Reminder Notification",status:"error",message:"Failed to send. Check browser console."}])}},Y=()=>{if(Notification.permission!=="granted"){r(s=>[...s,{type:"Direct Browser Test",status:"error",message:`Permission not granted. Status: ${Notification.permission}`}]);return}try{console.log("üîî [Test] Creating direct browser notification...");let s=!1;const i=new Notification("Direct Browser Test",{body:"This is a direct browser notification test. Can you see this?",icon:"/favicon.ico",badge:"/favicon.ico",tag:"direct-test",requireInteraction:!0,silent:!1});i.onshow=()=>{s=!0,console.log("‚úÖ [Test] Direct notification showed!"),r(p=>[...p,{type:"Direct Browser Test",status:"success",message:"‚úÖ Browser notification appeared! If you can&apos;t see it, check system notification center."}])},i.onerror=p=>{console.error("‚ùå [Test] Direct notification error:",p),r(k=>[...k,{type:"Direct Browser Test",status:"error",message:`Error: ${p}`}])},i.onclose=()=>{console.log("‚ÑπÔ∏è [Test] Direct notification closed")},setTimeout(()=>{s||(console.warn("‚ö†Ô∏è [Test] Notification may have been suppressed"),A({title:"Direct Browser Test",body:"Browser notification was created but may be suppressed. Check system notification center or try minimizing the browser window.",type:"warning"}),D(!0))},500)}catch(s){console.error("‚ùå [Test] Failed to create direct notification:",s),r(i=>[...i,{type:"Direct Browser Test",status:"error",message:`Failed: ${s.message}`}])}},G=async()=>{if(a)try{await z(a.id,"Test Supervisor",65,"Test feedback message"),r(s=>[...s,{type:"Performance Warning",status:"success",message:"Performance warning notification sent successfully!"}])}catch(s){r(i=>[...i,{type:"Performance Warning",status:"error",message:`Error: ${s.message}`}])}},H=async()=>{if(a)try{await M(a.id,"Test Admin",b),r(s=>[...s,{type:"Admin Warning",status:"success",message:"Admin warning notification sent successfully!"}])}catch(s){r(i=>[...i,{type:"Admin Warning",status:"error",message:`Error: ${s.message}`}])}},S=async s=>{if(a)try{s==="message"?await ie(a.id,"Test User",b,"test-conv"):s==="reminder"?await te(a.id,"Test User","test-conv"):s==="performance"?await re(a.id,"Test Supervisor",65,"Test feedback"):s==="admin"&&await ne(a.id,"Test Admin",b),r(i=>[...i,{type:`Direct ${s} Service`,status:"success",message:`${s} notification sent via direct service!`}])}catch(i){r(p=>[...p,{type:`Direct ${s} Service`,status:"error",message:`Error: ${i.message}`}])}},J=async()=>{try{await se()&&(u("Registered ‚úì"),r(i=>[...i,{type:"Service Worker",status:"success",message:"Service worker registered successfully!"}]))}catch(s){r(i=>[...i,{type:"Service Worker",status:"error",message:`Error: ${s.message}`}])}};return e.jsxs(e.Fragment,{children:[q&&w&&e.jsx(L,{title:w.title,body:w.body,type:w.type,duration:8e3,onClose:()=>{D(!1),A(null)}}),e.jsxs(oe,{maxWidth:"xl",children:[e.jsxs(n,{sx:{mb:4},children:[e.jsx(t,{variant:"h4",gutterBottom:!0,children:"Push Notification Test Page"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Test and verify your push notification setup"})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(g,{children:e.jsx(x,{children:e.jsxs(m,{direction:"row",alignItems:"center",spacing:2,children:[E?e.jsx(y,{size:24,color:o.palette.success.main}):e.jsx(C,{size:24,color:o.palette.error.main}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Browser Support"}),e.jsx(t,{variant:"h6",children:E?"Supported":"Not Supported"})]})]})})})}),e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(g,{children:e.jsx(x,{children:e.jsxs(m,{direction:"row",alignItems:"center",spacing:2,children:[j?e.jsx(y,{size:24,color:o.palette.success.main}):e.jsx(T,{size:24,color:o.palette.warning.main}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Permission"}),e.jsx(t,{variant:"h6",children:j?"Granted":"Not Granted"})]})]})})})}),e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(g,{children:e.jsx(x,{children:e.jsxs(m,{direction:"row",alignItems:"center",spacing:2,children:[h?e.jsx(y,{size:24,color:o.palette.success.main}):e.jsx(C,{size:24,color:o.palette.error.main}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"FCM Token"}),e.jsx(t,{variant:"h6",sx:{fontSize:"0.9rem",wordBreak:"break-all"},children:h&&h!=="browser-only"?e.jsxs(n,{children:[e.jsx(n,{children:"Present ‚úì"}),e.jsxs(t,{variant:"caption",sx:{fontSize:"0.7rem",color:"success.main"},children:[h.substring(0,30),"..."]})]}):h==="browser-only"?e.jsx(n,{sx:{color:"warning.main"},children:"Browser Only"}):"Not Found"})]})]})})})}),e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(g,{children:e.jsx(x,{children:e.jsxs(m,{direction:"row",alignItems:"center",spacing:2,children:[v.includes("‚úì")||v.includes("Active")?e.jsx(y,{size:24,color:o.palette.success.main}):e.jsx(T,{size:24,color:o.palette.warning.main}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Service Worker"}),e.jsx(t,{variant:"h6",sx:{fontSize:"0.9rem"},children:v})]})]})})})})]}),e.jsxs(g,{sx:{mb:3},children:[e.jsx(N,{title:"Setup"}),e.jsx(x,{children:e.jsxs(m,{spacing:2,children:[e.jsxs(n,{children:[e.jsxs(t,{variant:"subtitle2",sx:{mb:1},children:["Current Permission Status: ",e.jsx("strong",{children:Notification.permission})]}),Notification.permission==="denied"&&e.jsxs(n,{sx:{p:1.5,bgcolor:"error.light + 20",borderRadius:1,mb:2},children:[e.jsx(t,{variant:"body2",color:"error.main",sx:{fontWeight:600,mb:.5},children:"‚ö†Ô∏è Permission Denied"}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Notifications are blocked. Please enable them in your browser settings:",e.jsx("br",{}),"‚Ä¢ Chrome/Edge: Settings ‚Üí Privacy ‚Üí Site Settings ‚Üí Notifications",e.jsx("br",{}),"‚Ä¢ Firefox: Settings ‚Üí Privacy ‚Üí Permissions ‚Üí Notifications",e.jsx("br",{}),"‚Ä¢ Safari: Preferences ‚Üí Websites ‚Üí Notifications"]})]}),Notification.permission==="default"&&e.jsxs(n,{sx:{p:1.5,bgcolor:"info.light + 20",borderRadius:1,mb:2},children:[e.jsx(t,{variant:"body2",color:"info.main",sx:{fontWeight:600,mb:.5},children:"‚ÑπÔ∏è Permission Not Requested"}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Click the button below to request notification permission. You'll see a browser prompt."})]}),e.jsx(c,{variant:"contained",onClick:V,startIcon:e.jsx(W,{}),disabled:Notification.permission==="denied",children:Notification.permission==="denied"?"Permission Denied - Enable in Browser Settings":"Request Notification Permission"})]}),e.jsxs(n,{children:[e.jsxs(t,{variant:"subtitle2",sx:{mb:1},children:["Service Worker Status: ",v]}),e.jsx(c,{variant:"outlined",onClick:J,children:"Register Service Worker"})]}),h&&e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"FCM Token:"}),e.jsx(t,{variant:"body2",sx:{p:1,bgcolor:"grey.100",borderRadius:1,fontFamily:"monospace",wordBreak:"break-all"},children:h})]})]})})]}),e.jsxs(g,{sx:{mb:3},children:[e.jsx(N,{title:"Test Notifications"}),e.jsx(x,{children:e.jsxs(m,{spacing:3,children:[e.jsx(ae,{fullWidth:!0,label:"Test Message",value:b,onChange:s=>_(s.target.value),placeholder:"Enter test message here..."}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(c,{fullWidth:!0,variant:"outlined",onClick:K,startIcon:e.jsx(ce,{}),disabled:!j||Notification.permission!=="granted",title:Notification.permission!=="granted"?"Please grant notification permission first":"Test notification",children:"Test Message"})}),e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(c,{fullWidth:!0,variant:"outlined",onClick:U,startIcon:e.jsx(W,{}),disabled:!j,children:"Test Reminder"})}),e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(c,{fullWidth:!0,variant:"outlined",onClick:G,startIcon:e.jsx(T,{}),disabled:!j,children:"Test Performance"})}),e.jsx(d,{size:{xs:12,sm:6,md:3},children:e.jsx(c,{fullWidth:!0,variant:"outlined",onClick:H,startIcon:e.jsx(T,{}),disabled:!j,children:"Test Admin Warning"})})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"‚ö†Ô∏è Notifications Not Showing? Try This:"}),e.jsx(c,{variant:"contained",color:"warning",onClick:Y,sx:{mb:2},children:"Test Direct Browser Notification"}),e.jsxs(t,{variant:"caption",color:"text.secondary",component:"div",sx:{mb:2},children:["This bypasses all services and directly calls the browser Notification API.",e.jsx("br",{}),"If this doesn't show, check:",e.jsx("br",{}),"‚Ä¢ Browser notification settings (Do Not Disturb mode?)",e.jsx("br",{}),"‚Ä¢ System notification settings",e.jsx("br",{}),"‚Ä¢ Try minimizing and maximizing the browser window",e.jsx("br",{}),"‚Ä¢ Check if notifications appear in system notification center"]}),e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Test Direct Service (Bypass Context):"}),e.jsxs(m,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(c,{size:"small",variant:"text",onClick:()=>S("message"),children:"Direct Message"}),e.jsx(c,{size:"small",variant:"text",onClick:()=>S("reminder"),children:"Direct Reminder"}),e.jsx(c,{size:"small",variant:"text",onClick:()=>S("performance"),children:"Direct Performance"}),e.jsx(c,{size:"small",variant:"text",onClick:()=>S("admin"),children:"Direct Admin"})]})]})]})})]}),P.length>0&&e.jsxs(g,{children:[e.jsx(N,{title:"Test Results"}),e.jsxs(x,{children:[e.jsx(m,{spacing:1,children:P.map((s,i)=>e.jsx(n,{sx:{p:2,border:`1px solid ${o.palette.divider}`,borderRadius:1,bgcolor:s.status==="success"?o.palette.success.light+"20":o.palette.error.light+"20"},children:e.jsxs(m,{direction:"row",alignItems:"center",spacing:2,children:[s.status==="success"?e.jsx(y,{size:20,color:o.palette.success.main}):e.jsx(C,{size:20,color:o.palette.error.main}),e.jsx(Q,{label:s.type,size:"small",color:s.status==="success"?"success":"error"}),e.jsx(t,{variant:"body2",sx:{flex:1},children:s.message})]})},i))}),P.length>10&&e.jsx(c,{size:"small",onClick:()=>r([]),sx:{mt:2},children:"Clear Results"})]})]}),e.jsxs(g,{sx:{mt:3},children:[e.jsx(N,{title:"Debug Information"}),e.jsx(x,{children:e.jsxs(m,{spacing:2,children:[e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Environment Variables (check console for actual values):"}),e.jsxs(t,{variant:"body2",component:"pre",sx:{p:1,bgcolor:"grey.100",borderRadius:1,fontSize:"0.85rem"},children:["VITE_FIREBASE_VAPID_KEY: Set ‚úì",`
  Value: ${"BMc6C3IV-G1HKRMIXMMlaSf5HDkKa1yov8kXJvFqZGN3x3AxZEKF1sfUsJi0BiLYwJ3t65Ae7MjL31nZw-T8CUs".substring(0,30)}...`,`
VITE_FIREBASE_API_KEY: Set ‚úì (default) (using default)
VITE_FIREBASE_AUTH_DOMAIN: hostaway-918b7.firebaseapp.com (default)
VITE_FIREBASE_MESSAGING_SENDER_ID: 192565803775 (default)
VITE_FIREBASE_APP_ID: Set ‚úì (default) (using default)`]}),e.jsxs(n,{sx:{mt:2,p:2,bgcolor:"warning.light + 20",borderRadius:1},children:[e.jsx(t,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"‚ö†Ô∏è Notifications Not Appearing?"}),e.jsx(t,{variant:"body2",component:"div",sx:{fontSize:"0.85rem"},children:e.jsxs(n,{component:"ul",sx:{pl:2,m:0},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Check browser Do Not Disturb mode"})," - Disable it if enabled"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Check system notification settings"})," - Ensure browser can show notifications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Try minimizing the browser window"})," - Some browsers only show notifications when window is minimized"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Check system notification center"})," - Notifications might be there but not popping up"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Chrome/Edge:"})," Check chrome://settings/content/notifications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Firefox:"})," Check about:preferences#privacy ‚Üí Notifications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:'Try the "Test Direct Browser Notification" button'})," above"]})]})})]}),e.jsxs(n,{sx:{mt:2,p:2,bgcolor:"info.light + 20",borderRadius:1},children:[e.jsx(t,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"‚ÑπÔ∏è FCM Token Not Found?"}),e.jsx(t,{variant:"body2",component:"div",sx:{fontSize:"0.85rem"},children:e.jsxs(n,{component:"ul",sx:{pl:2,m:0},children:[e.jsx("li",{children:"Add VITE_FIREBASE_API_KEY and VITE_FIREBASE_APP_ID to .env.local"}),e.jsx("li",{children:"Restart dev server after adding env variables"}),e.jsx("li",{children:"Browser notifications work even without FCM token!"})]})})]})]}),e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Check Browser Console for detailed logs"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Open DevTools (F12) ‚Üí Console tab to see FCM token, service worker status, and any errors."})]})]})})]})]})]})}export{ke as NotificationTestPage};
