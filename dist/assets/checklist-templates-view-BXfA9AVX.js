import{D as J,r,j as e,B as h,T as a,a as x,I as f,d,Y as K,Z as w,$ as I,e as y,bh as E}from"./index-DDMGUD-_.js";import{D as Q}from"./content-DAzX26cm.js";import{T as X,a as j}from"./Tabs-DQ5TNJO7.js";import{C as M}from"./Card-C1fEEBVz.js";import{C as S}from"./CardContent-Bmb6KKQR.js";import{G as z}from"./Grid-CFM_c-Vf.js";import{L as V}from"./ListItemIcon-DlCYQ__M.js";import{C as ee}from"./Checkbox-DrgNyHeB.js";import{M as se}from"./Menu-Bm1ShPnp.js";import{D as L,a as $,b as B,c as _}from"./DialogContent-CkHDAA-B.js";import"./KeyboardArrowRight-D6UvfiY9.js";import"./SwitchBase-s8UEUZOy.js";function pe(){const c=J(),[W,O]=r.useState(2),[g,C]=r.useState(null),[i,n]=r.useState(null),[G,m]=r.useState(!1),[N,p]=r.useState(!1),[T,b]=r.useState([]),[R,k]=r.useState(!0);r.useEffect(()=>{(async()=>{k(!0);try{const t=localStorage.getItem("authToken");if(!t){k(!1);return}const l=await fetch(`${E}/api/checklist-templates?limit=1000`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(l.ok){const o=await l.json();o.success&&o.data&&b(o.data)}}catch(t){console.error("Error fetching checklist templates:",t)}finally{k(!1)}})()},[]);const Y=(s,t)=>{O(t),t===0&&c.push("/tasks/manage-tasks"),t===1&&c.push("/tasks/manage-auto-tasks"),t===3&&c.push("/tasks/archive")},F=(s,t)=>{C(s.currentTarget),n(t)},u=()=>{C(null),n(null)},v=()=>{c.push("/tasks/checklist-templates/new")},H=()=>{i&&c.push(`/tasks/checklist-templates/${i._id||i.id}/edit`),u()},P=()=>{p(!0),u()},U=()=>{i&&c.push(`/tasks/checklist-templates/${i._id||i.id}/duplicate`),p(!1),n(null)},D=()=>{p(!1),n(null)},Z=()=>{m(!0),u()},q=async()=>{if(i)try{const s=localStorage.getItem("authToken");if(!s){alert("Not authenticated");return}const t=await fetch(`${E}/api/checklist-templates/${i._id||i.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(t.ok)b(l=>l.filter(o=>(o._id||o.id)!==(i._id||i.id)));else{const l=await t.json();alert(l.message||"Failed to delete template")}}catch(s){console.error("Error deleting template:",s),alert("Failed to delete template")}m(!1),n(null)},A=()=>{m(!1),n(null)};return e.jsxs(Q,{maxWidth:"xl",children:[e.jsxs(h,{sx:{mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:600},children:"Tasks"}),e.jsx(x,{variant:"contained",onClick:v,children:"Add checklist template"})]}),e.jsxs(X,{value:W,onChange:Y,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:500},"& .Mui-selected":{color:"primary.main",fontWeight:600},"& .MuiTabs-indicator":{bgcolor:"primary.main"}},children:[e.jsx(j,{label:"Manage Tasks"}),e.jsx(j,{label:"Manage Auto-tasks"}),e.jsx(j,{label:"Checklist Templates"}),e.jsx(j,{label:"Archive"})]})]}),R?e.jsx(h,{sx:{textAlign:"center",py:4},children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Loading checklist templates..."})}):T.length===0?e.jsx(M,{children:e.jsxs(S,{sx:{textAlign:"center",py:4},children:[e.jsx(a,{variant:"h6",sx:{mb:2,color:"text.secondary"},children:"No checklist templates found"}),e.jsx(a,{variant:"body2",sx:{mb:3,color:"text.secondary"},children:"Get started by creating your first checklist template"}),e.jsx(x,{variant:"contained",onClick:v,children:"Add Checklist Template"})]})}):e.jsx(z,{container:!0,spacing:3,children:T.map(s=>e.jsx(z,{size:{xs:12,sm:6,md:4},children:e.jsx(M,{sx:{height:"100%",display:"flex",flexDirection:"column","&:hover":{boxShadow:2}},children:e.jsxs(S,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,flex:1},children:s.name}),e.jsx(f,{size:"small",onClick:t=>F(t,s),children:e.jsx(d,{icon:"eva:more-vertical-fill",width:16})})]}),e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[Array.isArray(s.tasks)?s.tasks.length:0," tasks to complete"]}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Tasks we have to do:"}),e.jsxs(K,{dense:!0,sx:{maxHeight:200,overflow:"auto"},children:[Array.isArray(s.tasks)?s.tasks.slice(0,4).map((t,l)=>{const o=typeof t=="string"?t:t.item||"";return e.jsxs(w,{sx:{py:.5,px:0},children:[e.jsx(V,{sx:{minWidth:32},children:e.jsx(ee,{size:"small",disabled:!0,sx:{p:.5}})}),e.jsx(I,{primary:e.jsx(a,{variant:"body2",sx:{fontSize:"0.875rem"},children:o})})]},l)}):null,Array.isArray(s.tasks)&&s.tasks.length>4&&e.jsx(w,{sx:{py:.5,px:0},children:e.jsx(I,{primary:e.jsxs(a,{variant:"caption",color:"text.secondary",children:["+",s.tasks.length-4," more tasks"]})})})]})]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:2},children:[e.jsx(f,{size:"small",onClick:()=>c.push(`/tasks/checklist-templates/${s._id||s.id}/edit`),children:e.jsx(d,{icon:"eva:edit-fill",width:16})}),e.jsx(f,{size:"small",onClick:()=>{n(s),p(!0)},children:e.jsx(d,{icon:"eva:copy-fill",width:16})}),e.jsx(f,{size:"small",sx:{color:"error.main"},onClick:()=>{n(s),m(!0)},children:e.jsx(d,{icon:"eva:trash-2-fill",width:16})})]})]})})},s._id||s.id))}),e.jsxs(se,{anchorEl:g,open:!!g,onClose:u,children:[e.jsxs(y,{onClick:H,children:[e.jsx(d,{icon:"eva:edit-fill",sx:{mr:1}}),"Edit"]}),e.jsxs(y,{onClick:P,children:[e.jsx(d,{icon:"eva:copy-fill",sx:{mr:1}}),"Duplicate"]}),e.jsxs(y,{onClick:Z,sx:{color:"error.main"},children:[e.jsx(d,{icon:"eva:trash-2-fill",sx:{mr:1}}),"Delete"]})]}),e.jsxs(L,{open:N,onClose:D,children:[e.jsx($,{children:"Duplicate?"}),e.jsx(B,{children:e.jsx(a,{children:'Are you sure you want to duplicate this checklist template? This will create a copy with "(Copy)" added to the name.'})}),e.jsxs(_,{children:[e.jsx(x,{onClick:D,children:"No"}),e.jsx(x,{onClick:U,variant:"contained",children:"Yes"})]})]}),e.jsxs(L,{open:G,onClose:A,children:[e.jsx($,{children:"Delete?"}),e.jsx(B,{children:e.jsx(a,{children:"Are you sure you want to delete this checklist template? This action cannot be undone."})}),e.jsxs(_,{children:[e.jsx(x,{onClick:A,children:"No"}),e.jsx(x,{onClick:q,color:"error",variant:"contained",children:"Yes"})]})]})]})}export{pe as ChecklistTemplatesView};
