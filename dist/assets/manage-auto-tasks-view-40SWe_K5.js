import{D as J,r as l,j as e,B as a,T as n,a as x,I as u,d as c,C as q,e as p,bh as v}from"./index-DDMGUD-_.js";import{D as H}from"./content-DAzX26cm.js";import{T as K,a as f}from"./Tabs-DQ5TNJO7.js";import{C as $}from"./Card-C1fEEBVz.js";import{C as z}from"./CardContent-Bmb6KKQR.js";import{G as _}from"./Grid-CFM_c-Vf.js";import{S as Q}from"./Switch-CS1Ni3s3.js";import{M as V}from"./Menu-Bm1ShPnp.js";import{D as X,a as Y,b as Z,c as ee}from"./DialogContent-CkHDAA-B.js";import"./KeyboardArrowRight-D6UvfiY9.js";import"./SwitchBase-s8UEUZOy.js";function xe(){const d=J(),[T,W]=l.useState(1),[k,A]=l.useState(null),[j,D]=l.useState(null),[N,m]=l.useState(!1),[r,g]=l.useState(null),[w,y]=l.useState([]),[O,C]=l.useState(!0);l.useEffect(()=>{(async()=>{C(!0);try{const s=localStorage.getItem("authToken");if(!s){C(!1);return}const i=await fetch(`${v}/api/auto-tasks?limit=1000`,{method:"GET",headers:{Authorization:`Bearer ${s}`}});if(i.ok){const o=await i.json();o.success&&o.data&&y(o.data)}}catch(s){console.error("Error fetching auto-tasks:",s)}finally{C(!1)}})()},[]);const F=(t,s)=>{W(s),s===0&&d.push("/tasks/manage-tasks"),s===2&&d.push("/tasks/checklist-templates"),s===3&&d.push("/tasks/archive")},G=(t,s)=>{A(t.currentTarget),D(s)},b=()=>{A(null),D(null)},E=()=>{d.push("/tasks/auto-tasks/new")},S=t=>{d.push(`/tasks/auto-tasks/${t._id||t.id}/edit`)},B=t=>{d.push(`/tasks/auto-tasks/${t._id||t.id}/duplicate`)},M=t=>{g(t),m(!0),b()},R=async()=>{if(r)try{const t=localStorage.getItem("authToken");if(!t){alert("Not authenticated");return}const s=await fetch(`${v}/api/auto-tasks/${r._id||r.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(s.ok)y(i=>i.filter(o=>(o._id||o.id)!==(r._id||r.id)));else{const i=await s.json();alert(i.message||"Failed to delete auto-task")}}catch(t){console.error("Error deleting auto-task:",t),alert("Failed to delete auto-task")}m(!1),g(null)},I=()=>{m(!1),g(null)},U=async t=>{try{const s=localStorage.getItem("authToken");if(!s){alert("Not authenticated");return}const i=t.status==="Active"?"Inactive":"Active",o=await fetch(`${v}/api/auto-tasks/${t._id||t.id}/toggle-status`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({status:i})});if(o.ok)(await o.json()).success&&y(P=>P.map(h=>(h._id||h.id)===(t._id||t.id)?{...h,status:i}:h));else{const L=await o.json();alert(L.message||"Failed to toggle status")}}catch(s){console.error("Error toggling status:",s),alert("Failed to toggle status")}};return e.jsxs(H,{maxWidth:"xl",children:[e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(n,{variant:"h4",sx:{fontWeight:600},children:"Tasks"}),e.jsx(x,{variant:"contained",onClick:E,children:"Add Tasks"})]}),e.jsxs(K,{value:T,onChange:F,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:500},"& .Mui-selected":{color:"primary.main",fontWeight:600},"& .MuiTabs-indicator":{bgcolor:"primary.main"}},children:[e.jsx(f,{label:"Manage Tasks"}),e.jsx(f,{label:"Manage Auto-tasks"}),e.jsx(f,{label:"Checklist Templates"}),e.jsx(f,{label:"Archive"})]})]}),O?e.jsx(a,{sx:{textAlign:"center",py:4},children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"Loading auto-tasks..."})}):w.length===0?e.jsx($,{children:e.jsxs(z,{sx:{textAlign:"center",py:4},children:[e.jsx(n,{variant:"h6",sx:{mb:2,color:"text.secondary"},children:"No auto-tasks found"}),e.jsx(n,{variant:"body2",sx:{mb:3,color:"text.secondary"},children:"Get started by creating your first auto-task"}),e.jsx(x,{variant:"contained",onClick:E,children:"Add Auto-task"})]})}):e.jsx(_,{container:!0,spacing:3,children:w.map(t=>{var s;return e.jsx(_,{size:{xs:12,sm:6,md:4},children:e.jsx($,{sx:{height:"100%",bgcolor:t.status==="Active"?"grey.50":"background.paper",border:1,borderColor:"grey.200","&:hover":{boxShadow:2}},children:e.jsxs(z,{children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,flex:1},children:t.name}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{checked:t.status==="Active",onChange:()=>U(t),size:"small"}),e.jsx(u,{size:"small",onClick:i=>G(i,t),children:e.jsx(c,{icon:"eva:more-vertical-fill",width:16})})]})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.description}),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Starting Event:"}),e.jsx(n,{variant:"caption",sx:{fontWeight:500},children:t.startingEvent||"-"})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Due Before:"}),e.jsx(n,{variant:"caption",sx:{fontWeight:500},children:t.shouldEndByValue&&t.shouldEndByUnit?`${t.shouldEndByValue} ${t.shouldEndByUnit}`:t.dueBefore||"-"})]}),t.linkedChannel&&e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Linked Channel:"}),e.jsx(q,{label:t.linkedChannel,size:"small",color:"primary"})]}),t.linkedListing&&e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Linked Listing:"}),e.jsx(n,{variant:"caption",sx:{fontWeight:500},children:typeof t.linkedListing=="string"?t.linkedListing:((s=t.linkedListing)==null?void 0:s.name)||"Multiple Listings"})]})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:2},children:[e.jsx(u,{size:"small",onClick:()=>S(t),children:e.jsx(c,{icon:"eva:edit-fill",width:16})}),e.jsx(u,{size:"small",onClick:()=>B(t),children:e.jsx(c,{icon:"eva:copy-fill",width:16})}),e.jsx(u,{size:"small",sx:{color:"error.main"},onClick:()=>M(t),children:e.jsx(c,{icon:"eva:trash-2-fill",width:16})})]})]})})},t._id||t.id)})}),e.jsxs(V,{anchorEl:k,open:!!k,onClose:b,children:[e.jsxs(p,{onClick:()=>S(j),children:[e.jsx(c,{icon:"eva:edit-fill",sx:{mr:1}}),"Edit"]}),e.jsxs(p,{onClick:()=>B(j),children:[e.jsx(c,{icon:"eva:copy-fill",sx:{mr:1}}),"Duplicate"]}),e.jsxs(p,{onClick:b,children:[e.jsx(c,{icon:"eva:play-circle-fill",sx:{mr:1}}),"Run Now"]}),e.jsxs(p,{onClick:()=>M(j),sx:{color:"error.main"},children:[e.jsx(c,{icon:"eva:trash-2-fill",sx:{mr:1}}),"Delete"]})]}),e.jsxs(X,{open:N,onClose:I,children:[e.jsx(Y,{children:"Delete Auto-task"}),e.jsx(Z,{children:e.jsxs(n,{children:['Are you sure you want to delete "',r==null?void 0:r.name,'"? This action cannot be undone.']})}),e.jsxs(ee,{children:[e.jsx(x,{onClick:I,children:"Cancel"}),e.jsx(x,{onClick:R,variant:"contained",color:"error",children:"Delete"})]})]})]})}export{xe as ManageAutoTasksView};
