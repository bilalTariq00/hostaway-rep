import{D as U,r as i,j as t,B as s,I as f,T as r,a as v,x as O,e as G}from"./index-DDMGUD-_.js";import{D as K}from"./content-DAzX26cm.js";import{A as X}from"./arrow-left-DVLbOZnK.js";import{S as Z}from"./save-D0sLAz8V.js";import{C as j}from"./Card-C1fEEBVz.js";import{T as c}from"./TextField-BZcg-6kp.js";import{I as y}from"./info-_UHBnIlD.js";import{F as ee}from"./FormControl-BRgYzLHi.js";import{I as te}from"./InputLabel-B_w9HMQG.js";import{S as se}from"./Select-DixiLax7.js";import{F as ae}from"./FormControlLabel-nlFIIXjS.js";import{C as _}from"./Checkbox-DrgNyHeB.js";import"./Menu-Bm1ShPnp.js";import"./SwitchBase-s8UEUZOy.js";const z=[{id:1,name:"Luxury Villa Rome",image:"https://pub-c5e31b5cdafb419fb247a8ac2e78df7a.r2.dev/public/assets/images/mock/cover/cover-5.webp",selected:!1},{id:2,name:"Modern Apartment Milan",image:"https://pub-c5e31b5cdafb419fb247a8ac2e78df7a.r2.dev/public/assets/images/mock/cover/cover-6.webp",selected:!1},{id:3,name:"Cozy Studio Florence",image:"https://pub-c5e31b5cdafb419fb247a8ac2e78df7a.r2.dev/public/assets/images/mock/cover/cover-4.webp",selected:!1},{id:4,name:"Beach House Naples",image:"https://pub-c5e31b5cdafb419fb247a8ac2e78df7a.r2.dev/public/assets/images/mock/cover/cover-5.webp",selected:!1},{id:5,name:"Mountain Cabin Turin",image:"https://pub-c5e31b5cdafb419fb247a8ac2e78df7a.r2.dev/public/assets/images/mock/cover/cover-6.webp",selected:!1},{id:6,name:"City Loft Venice",image:"https://pub-c5e31b5cdafb419fb247a8ac2e78df7a.r2.dev/public/assets/images/mock/cover/cover-4.webp",selected:!1}],le=[{value:"airbnb",label:"Airbnb",color:"#FF5A5F"},{value:"booking",label:"Booking.com",color:"#003580"},{value:"vrbo",label:"VRBO",color:"#00A699"},{value:"expedia",label:"Expedia",color:"#FFB800"},{value:"all",label:"All Channels",color:"#6c757d"}],oe=[{value:"booking_confirmed",label:"Booking Confirmed"},{value:"check_in_reminder",label:"Check-in Reminder"},{value:"check_out_reminder",label:"Check-out Reminder"},{value:"review_request",label:"Review Request"},{value:"cancellation",label:"Cancellation"}];function je(){const m=U(),[C,P]=i.useState(null),[h,k]=i.useState(""),[w,S]=i.useState(""),[A,I]=i.useState(""),[p,E]=i.useState(""),[g,L]=i.useState(""),[T,D]=i.useState(""),[d,W]=i.useState([]),[u,b]=i.useState(z),[R,q]=i.useState(""),[M,N]=i.useState(!1);i.useEffect(()=>{const e=window.location.pathname.split("/"),l=parseInt(e[e.length-1]);P(l);const o=localStorage.getItem("automations");let a=null;o&&(a=JSON.parse(o).find(n=>n.id===l)),a||(a=[{id:1,title:"POLACCHI: Prenotazione confermata",subject:"Thank you for your reservation! ðŸ‘‹",defaultMessage:"Thank you for your reservation! We look forward to hosting you.",eventTrigger:"booking_confirmed",ccEmail1:"host@example.com",ccEmail2:"",selectedChannels:["booking","airbnb"],selectedListings:[{id:1,name:"Polacchi42"}]},{id:2,title:"Welcome Message Automation",subject:"Welcome to your stay!",defaultMessage:"Welcome to your stay! We hope you have a wonderful time.",eventTrigger:"booking_confirmed",ccEmail1:"welcome@example.com",ccEmail2:"",selectedChannels:["airbnb","booking"],selectedListings:[{id:2,name:"Beach House Villa"}]},{id:3,title:"Check-in Instructions",subject:"Your check-in details",defaultMessage:"Here are your check-in instructions. Please follow them carefully.",eventTrigger:"check_in_reminder",ccEmail1:"checkin@example.com",ccEmail2:"",selectedChannels:["airbnb","vrbo"],selectedListings:[{id:3,name:"Downtown Apartment"}]},{id:4,title:"Review Request",subject:"How was your stay?",defaultMessage:"Thank you for staying with us! Please share your experience.",eventTrigger:"review_request",ccEmail1:"reviews@example.com",ccEmail2:"",selectedChannels:["airbnb","booking","vrbo"],selectedListings:[{id:4,name:"City Center Loft"}]}].find(n=>n.id===l)),a?(k(a.title||""),S(a.ccEmail1||""),I(a.ccEmail2||""),E(a.subject||""),L(a.defaultMessage||""),D(a.eventTrigger||""),W(a.selectedChannels||[]),b(z.map(x=>{var n;return{...x,selected:((n=a.selectedListings)==null?void 0:n.some(Y=>Y.id===x.id))||!1}}))):m.push("/inbox/automations")},[m]);const H=()=>{const e={id:C,title:h,ccEmail1:w,ccEmail2:A,subject:p,defaultMessage:g,eventTrigger:T,selectedChannels:d,selectedListings:u.filter(a=>a.selected),isActive:!0,creationDate:new Date().toISOString(),lastEdit:new Date().toLocaleString(),automationId:`AUTO-${Date.now()}`},o=JSON.parse(localStorage.getItem("automations")||"[]").map(a=>a.id===C?e:a);localStorage.setItem("automations",JSON.stringify(o)),m.push("/inbox/automations")},F=()=>{m.push("/inbox/automations")},V=e=>{W(l=>l.includes(e)?l.filter(o=>o!==e):[...l,e])},B=e=>{b(l=>l.map(o=>o.id===e?{...o,selected:!o.selected}:o))},$=()=>{const e=u.every(l=>l.selected);b(l=>l.map(o=>({...o,selected:!e})))},J=u.filter(e=>{const l=e.name.toLowerCase().includes(R.toLowerCase()),o=M?e.selected:!0;return l&&o}),Q=u.filter(e=>e.selected).length;return t.jsxs(K,{maxWidth:"xl",children:[t.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[t.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(f,{onClick:F,sx:{p:1},children:t.jsx(X,{size:20})}),t.jsx(r,{variant:"h4",children:"Edit Automation"})]}),t.jsxs(s,{sx:{display:"flex",gap:2},children:[t.jsx(v,{variant:"outlined",onClick:F,children:"Cancel"}),t.jsx(v,{variant:"contained",onClick:H,disabled:!h||!p||!g,startIcon:t.jsx(Z,{size:20}),children:"Save"})]})]}),t.jsxs(s,{sx:{display:"flex",gap:3,flexDirection:{xs:"column",lg:"row"}},children:[t.jsxs(s,{sx:{flex:2,minWidth:0},children:[t.jsxs(j,{sx:{p:3,mb:3},children:[t.jsx(r,{variant:"h6",sx:{mb:3},children:"Automation Details"}),t.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:3},children:[t.jsx(c,{label:"Automation Name",value:h,onChange:e=>k(e.target.value),fullWidth:!0,required:!0}),t.jsxs(s,{sx:{display:"flex",gap:2},children:[t.jsx(c,{label:"CC Email 1",value:w,onChange:e=>S(e.target.value),fullWidth:!0,type:"email"}),t.jsx(c,{label:"CC Email 2",value:A,onChange:e=>I(e.target.value),fullWidth:!0,type:"email"})]}),t.jsxs(s,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(c,{label:"Subject",value:p,onChange:e=>E(e.target.value),fullWidth:!0,required:!0}),t.jsx(O,{title:"Add placeholder",children:t.jsx(f,{children:t.jsx(y,{size:20})})})]}),t.jsxs(s,{sx:{display:"flex",gap:1,alignItems:"flex-start"},children:[t.jsx(c,{label:"Default Message",value:g,onChange:e=>L(e.target.value),fullWidth:!0,multiline:!0,rows:4,required:!0}),t.jsx(O,{title:"Add placeholder",children:t.jsx(f,{children:t.jsx(y,{size:20})})})]}),t.jsxs(ee,{fullWidth:!0,children:[t.jsx(te,{children:"Event Trigger"}),t.jsx(se,{value:T,onChange:e=>D(e.target.value),label:"Event Trigger",children:oe.map(e=>t.jsx(G,{value:e.value,children:e.label},e.value))})]})]})]}),t.jsxs(j,{sx:{p:3},children:[t.jsx(r,{variant:"h6",sx:{mb:3},children:"Additional Conditions"}),t.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:3},children:t.jsxs(s,{children:[t.jsx(r,{variant:"subtitle2",sx:{mb:2},children:"Channels"}),t.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:le.map(e=>t.jsxs(s,{onClick:()=>V(e.value),sx:{display:"flex",alignItems:"center",gap:1,px:2,py:1,borderRadius:1,border:"1px solid",borderColor:d.includes(e.value)?e.color:"grey.300",bgcolor:d.includes(e.value)?`${e.color}20`:"white",cursor:"pointer","&:hover":{bgcolor:d.includes(e.value)?`${e.color}30`:"grey.50"}},children:[t.jsx(s,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:e.color}}),t.jsx(r,{variant:"body2",children:e.label}),d.includes(e.value)&&t.jsx(s,{sx:{ml:1,color:e.color},children:"Ã—"})]},e.value))})]})})]})]}),t.jsx(s,{sx:{flex:1,minWidth:350,maxWidth:400},children:t.jsxs(j,{sx:{p:3},children:[t.jsx(r,{variant:"h6",sx:{mb:3},children:"Listings"}),t.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t.jsx(c,{placeholder:"Search listings...",value:R,onChange:e=>q(e.target.value),size:"small",InputProps:{startAdornment:t.jsx(y,{size:16,style:{marginRight:8,color:"#666"}})}}),t.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(ae,{control:t.jsx(_,{checked:M,onChange:e=>N(e.target.checked)}),label:"Show selected only"}),t.jsx(v,{size:"small",onClick:$,children:"Select All"})]}),t.jsxs(r,{variant:"body2",color:"text.secondary",children:[Q," of ",u.length," selected"]}),t.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:400,overflowY:"auto"},children:J.map(e=>t.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,p:2,border:"1px solid",borderColor:e.selected?"primary.main":"grey.200",borderRadius:1,bgcolor:e.selected?"primary.50":"white",cursor:"pointer","&:hover":{borderColor:"primary.main",bgcolor:e.selected?"primary.100":"grey.50"}},onClick:()=>B(e.id),children:[t.jsx(_,{checked:e.selected,onChange:()=>B(e.id)}),t.jsx(s,{sx:{width:40,height:40,borderRadius:1,backgroundImage:`url('${e.image}')`,backgroundSize:"cover",backgroundPosition:"center",flexShrink:0}}),t.jsx(r,{variant:"body2",sx:{flex:1},children:e.name})]},e.id))})]})]})})]})]})}export{je as AutomationEditView};
