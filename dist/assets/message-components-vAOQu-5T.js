import{c as H,a$ as U,b0 as ee,H as te,r as u,j as d,B as S,T as C,A as I,a4 as ne}from"./index-DDMGUD-_.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Ue=H("smile",re);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],et=H("wifi-off",ae),j=new Map;function tt(e,n,t){const{socket:a,isConnected:r,emit:i,on:c,off:o}=U(),{sendMessageNotification:g,sendReminderNotification:f}=ee(),{user:l}=te(),b=u.useRef(new Map),[m,y]=u.useState([]),[x,p]=u.useState(null),T=u.useRef(null),J=u.useRef(0),P=u.useRef(new Map);u.useEffect(()=>{if(e){const s=j.get(e)||[];s.length>0?(y(s),console.log(`ðŸ“± [${e}] Loaded ${s.length} messages for conversation`)):t&&t.length>0?(y(t),j.set(e,t),console.log(`ðŸ“± [${e}] Loaded ${t.length} initial messages for conversation`)):(y([]),console.log(`ðŸ“± [${e}] No messages found for conversation`))}},[e,t]);const Y=u.useCallback(()=>`msg_${Date.now()}_${++J.current}`,[]),E=u.useCallback((s,M)=>{if(!M||M.senderId===s.senderId)return;const w=(s.receivedAt||s.sentAt)-M.sentAt;return Math.max(0,w/1e3)},[]),Q=u.useCallback((s,M)=>{if(!a||!r||!s.trim()){p("Not connected to server or empty message");return}const w=Y(),D=Date.now(),h={id:w,senderId:n||"current-user",receiverId:M,message:s.trim(),sentAt:D,isOwn:!0};console.log(`ðŸ“¤ [${e}] Sending message:`,{messageId:w,senderId:h.senderId,receiverId:M,message:s.trim(),sentAt:new Date(D).toLocaleTimeString(),conversationId:e}),P.current.set(w,h),y(k=>{const W=[...k,h];return T.current=h,e&&(j.set(e,W),console.log(`ðŸ’¾ [${e}] Stored ${W.length} messages in conversation storage`)),W}),i("message:send",{messageId:w,senderId:h.senderId,receiverId:M,message:s.trim(),sentAt:D,conversationId:e}),p(null)},[a,r,i,e,Y,n]),R=u.useCallback(s=>{const M=Date.now();if(e&&s.conversationId!==e){console.log(`ðŸš« [${e}] Ignoring message for different conversation: ${s.conversationId}`);return}console.log(`ðŸ“¥ [${e}] Received message:`,{messageId:s.messageId,senderId:s.senderId,receiverId:s.receiverId,message:s.message,sentAt:new Date(s.sentAt).toLocaleTimeString(),receivedAt:new Date(M).toLocaleTimeString(),conversationId:e});const w=E({id:s.messageId,...s,receivedAt:M,isOwn:s.senderId===(n||"current-user")},T.current);w&&console.log(`âš¡ [${e}] Response time: ${w.toFixed(2)}s`);const D={id:s.messageId,senderId:s.senderId,receiverId:s.receiverId,message:s.message,sentAt:s.sentAt,receivedAt:M,responseTime:w,isOwn:s.senderId===(n||"current-user")};if(y(h=>{const k=[...h,D];return T.current=D,e&&(j.set(e,k),console.log(`ðŸ’¾ [${e}] Updated conversation storage with ${k.length} messages`)),k}),!D.isOwn&&l){const h=s.senderId!==(n||"current-user")?"Guest":"Team Member";if(s.receiverId||s.senderId,s.receiverId&&s.receiverId!==s.senderId&&g(s.receiverId,h,s.message,e||""),l.id===s.receiverId&&(l.assignedManager&&g(l.assignedManager,h,s.message,e||""),l.assignedSupervisor&&g(l.assignedSupervisor,h,s.message,e||"")),e){const k=b.current.get(e);k&&clearTimeout(k);const W=setTimeout(()=>{const z=T.current;z&&!z.isOwn&&z.id===s.messageId&&l&&l.id===s.receiverId&&f(l.id,h,e),b.current.delete(e)},5*60*1e3);b.current.set(e,W)}}if(P.current.has(s.messageId)&&(P.current.delete(s.messageId),console.log(`âœ… [${e}] Message ${s.messageId} confirmed and removed from pending`)),D.isOwn&&e){const h=b.current.get(e);h&&(clearTimeout(h),b.current.delete(e))}},[E,n,e,g,f,l]),N=u.useCallback(s=>{s.status==="failed"&&(p("Failed to send message"),y(M=>M.filter(w=>w.id!==s.messageId)),P.current.delete(s.messageId))},[]),G=u.useCallback(()=>{console.log(`ðŸ—‘ï¸ [${e}] Clearing all messages`),y([]),T.current=null,P.current.clear(),p(null),e&&(j.delete(e),console.log(`ðŸ’¾ [${e}] Cleared conversation storage`))},[e]),K=u.useCallback(()=>{a&&!r&&a.connect()},[a,r]);u.useEffect(()=>{if(a)return c("message:receive",R),c("message:confirm",N),()=>{o("message:receive",R),o("message:confirm",N)}},[a,c,o,R,N]),u.useEffect(()=>()=>{P.current.clear(),b.current.forEach(s=>clearTimeout(s)),b.current.clear()},[]),u.useEffect(()=>{!r&&P.current.size>0?p("Connection lost. Messages may not be delivered."):r&&p(null)},[r]);const Z=u.useCallback(s=>{a&&r&&e&&i("typing",{conversationId:e,userId:n||"current-user",isTyping:s})},[a,r,i,e,n]);return{messages:m,isConnected:r,error:x,sendMessage:Q,clearMessages:G,retryConnection:K,emitTyping:Z}}const O=43200,V=1440,B=Symbol.for("constructDateFrom");function L(e,n){return typeof e=="function"?e(n):e&&typeof e=="object"&&B in e?e[B](n):e instanceof Date?new e.constructor(n):new Date(n)}function v(e,n){return L(e,e)}let se={};function oe(){return se}function q(e){const n=v(e),t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return t.setUTCFullYear(n.getFullYear()),+e-+t}function X(e,...n){const t=L.bind(null,e||n.find(a=>typeof a=="object"));return n.map(t)}function $(e,n){const t=+v(e)-+v(n);return t<0?-1:t>0?1:t}function ie(e){return L(e,Date.now())}function ce(e,n,t){const[a,r]=X(t==null?void 0:t.in,e,n),i=a.getFullYear()-r.getFullYear(),c=a.getMonth()-r.getMonth();return i*12+c}function ue(e){return n=>{const a=(e?Math[e]:Math.trunc)(n);return a===0?0:a}}function le(e,n){return+v(e)-+v(n)}function de(e,n){const t=v(e);return t.setHours(23,59,59,999),t}function me(e,n){const t=v(e),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}function fe(e,n){const t=v(e);return+de(t)==+me(t)}function he(e,n,t){const[a,r,i]=X(t==null?void 0:t.in,e,e,n),c=$(r,i),o=Math.abs(ce(r,i));if(o<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-c*o);let g=$(r,i)===-c;fe(a)&&o===1&&$(a,i)===1&&(g=!1);const f=c*(o-+g);return f===0?0:f}function ge(e,n,t){const a=le(e,n)/1e3;return ue(t==null?void 0:t.roundingMethod)(a)}const ye={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},be=(e,n,t)=>{let a;const r=ye[e];return typeof r=="string"?a=r:n===1?a=r.one:a=r.other.replace("{{count}}",n.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+a:a+" ago":a};function _(e){return(n={})=>{const t=n.width?String(n.width):e.defaultWidth;return e.formats[t]||e.formats[e.defaultWidth]}}const Me={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},we={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},xe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},pe={date:_({formats:Me,defaultWidth:"full"}),time:_({formats:we,defaultWidth:"full"}),dateTime:_({formats:xe,defaultWidth:"full"})},De={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ke=(e,n,t,a)=>De[e];function A(e){return(n,t)=>{const a=t!=null&&t.context?String(t.context):"standalone";let r;if(a==="formatting"&&e.formattingValues){const c=e.defaultFormattingWidth||e.defaultWidth,o=t!=null&&t.width?String(t.width):c;r=e.formattingValues[o]||e.formattingValues[c]}else{const c=e.defaultWidth,o=t!=null&&t.width?String(t.width):e.defaultWidth;r=e.values[o]||e.values[c]}const i=e.argumentCallback?e.argumentCallback(n):n;return r[i]}}const Se={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ve={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Pe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ce={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Te={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},We={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},je=(e,n)=>{const t=Number(e),a=t%100;if(a>20||a<10)switch(a%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Ae={ordinalNumber:je,era:A({values:Se,defaultWidth:"wide"}),quarter:A({values:ve,defaultWidth:"wide",argumentCallback:e=>e-1}),month:A({values:Pe,defaultWidth:"wide"}),day:A({values:Ce,defaultWidth:"wide"}),dayPeriod:A({values:Te,defaultWidth:"wide",formattingValues:We,defaultFormattingWidth:"wide"})};function F(e){return(n,t={})=>{const a=t.width,r=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],i=n.match(r);if(!i)return null;const c=i[0],o=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],g=Array.isArray(o)?Oe(o,b=>b.test(c)):Fe(o,b=>b.test(c));let f;f=e.valueCallback?e.valueCallback(g):g,f=t.valueCallback?t.valueCallback(f):f;const l=n.slice(c.length);return{value:f,rest:l}}}function Fe(e,n){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&n(e[t]))return t}function Oe(e,n){for(let t=0;t<e.length;t++)if(n(e[t]))return t}function $e(e){return(n,t={})=>{const a=n.match(e.matchPattern);if(!a)return null;const r=a[0],i=n.match(e.parsePattern);if(!i)return null;let c=e.valueCallback?e.valueCallback(i[0]):i[0];c=t.valueCallback?t.valueCallback(c):c;const o=n.slice(r.length);return{value:c,rest:o}}}const Re=/^(\d+)(th|st|nd|rd)?/i,Ne=/\d+/i,ze={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},_e={any:[/^b/i,/^(a|c)/i]},Le={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Xe={any:[/1/i,/2/i,/3/i,/4/i]},Ye={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ee={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ie={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ve={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Be={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},qe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},He={ordinalNumber:$e({matchPattern:Re,parsePattern:Ne,valueCallback:e=>parseInt(e,10)}),era:F({matchPatterns:ze,defaultMatchWidth:"wide",parsePatterns:_e,defaultParseWidth:"any"}),quarter:F({matchPatterns:Le,defaultMatchWidth:"wide",parsePatterns:Xe,defaultParseWidth:"any",valueCallback:e=>e+1}),month:F({matchPatterns:Ye,defaultMatchWidth:"wide",parsePatterns:Ee,defaultParseWidth:"any"}),day:F({matchPatterns:Ie,defaultMatchWidth:"wide",parsePatterns:Ve,defaultParseWidth:"any"}),dayPeriod:F({matchPatterns:Be,defaultMatchWidth:"any",parsePatterns:qe,defaultParseWidth:"any"})},Je={code:"en-US",formatDistance:be,formatLong:pe,formatRelative:ke,localize:Ae,match:He,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Qe(e,n,t){const a=oe(),r=(t==null?void 0:t.locale)??a.locale??Je,i=2520,c=$(e,n);if(isNaN(c))throw new RangeError("Invalid time value");const o=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:c}),[g,f]=X(t==null?void 0:t.in,...c>0?[n,e]:[e,n]),l=ge(f,g),b=(q(f)-q(g))/1e3,m=Math.round((l-b)/60);let y;if(m<2)return t!=null&&t.includeSeconds?l<5?r.formatDistance("lessThanXSeconds",5,o):l<10?r.formatDistance("lessThanXSeconds",10,o):l<20?r.formatDistance("lessThanXSeconds",20,o):l<40?r.formatDistance("halfAMinute",0,o):l<60?r.formatDistance("lessThanXMinutes",1,o):r.formatDistance("xMinutes",1,o):m===0?r.formatDistance("lessThanXMinutes",1,o):r.formatDistance("xMinutes",m,o);if(m<45)return r.formatDistance("xMinutes",m,o);if(m<90)return r.formatDistance("aboutXHours",1,o);if(m<V){const x=Math.round(m/60);return r.formatDistance("aboutXHours",x,o)}else{if(m<i)return r.formatDistance("xDays",1,o);if(m<O){const x=Math.round(m/V);return r.formatDistance("xDays",x,o)}else if(m<O*2)return y=Math.round(m/O),r.formatDistance("aboutXMonths",y,o)}if(y=he(f,g),y<12){const x=Math.round(m/O);return r.formatDistance("xMonths",x,o)}else{const x=y%12,p=Math.trunc(y/12);return x<3?r.formatDistance("aboutXYears",p,o):x<9?r.formatDistance("overXYears",p,o):r.formatDistance("almostXYears",p+1,o)}}function Ge(e,n){return Qe(e,ie(e),n)}const Ke=u.memo(function({message:n,showAvatar:t=!0,showResponseTime:a=!0}){const r=n.isOwn,i=n.responseTime;return d.jsxs(S,{sx:{display:"flex",justifyContent:r?"flex-end":"flex-start",mb:2,alignItems:"flex-end",gap:1},children:[!r&&t&&d.jsx(I,{sx:{width:32,height:32,fontSize:"0.875rem",bgcolor:"primary.main",color:"primary.contrastText"},children:n.senderId.charAt(0).toUpperCase()}),d.jsxs(S,{sx:{maxWidth:"70%",minWidth:"120px"},children:[d.jsx(ne,{elevation:1,sx:{p:2,borderRadius:2,backgroundColor:r?"primary.main":"grey.100",color:r?"primary.contrastText":"text.primary",position:"relative",wordBreak:"break-word","&::before":r?{content:'""',position:"absolute",right:-8,bottom:8,width:0,height:0,borderLeft:"8px solid",borderLeftColor:"primary.main",borderTop:"8px solid transparent",borderBottom:"8px solid transparent"}:{content:'""',position:"absolute",left:-8,bottom:8,width:0,height:0,borderRight:"8px solid",borderRightColor:"grey.100",borderTop:"8px solid transparent",borderBottom:"8px solid transparent"}},children:d.jsx(C,{variant:"body2",sx:{lineHeight:1.5,whiteSpace:"pre-wrap",color:"inherit"},children:n.message})}),d.jsxs(S,{sx:{display:"flex",justifyContent:r?"flex-end":"flex-start",alignItems:"center",mt:.5,gap:1,px:1},children:[d.jsx(C,{variant:"caption",sx:{fontSize:"0.75rem",color:"text.secondary"},children:Ge(new Date(n.sentAt),{addSuffix:!0})}),a&&i!==void 0&&d.jsx(S,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,py:.25,borderRadius:1,backgroundColor:"success.light",color:"success.contrastText"},children:d.jsxs(C,{variant:"caption",sx:{fontSize:"0.7rem",fontWeight:500},children:["âš¡ ",i<1?`${(i*1e3).toFixed(0)}ms`:`${i.toFixed(1)}s`]})}),r&&d.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:.25},children:[d.jsx(S,{sx:{width:4,height:4,borderRadius:"50%",backgroundColor:"success.main"}}),d.jsx(C,{variant:"caption",sx:{fontSize:"0.7rem",color:"text.secondary"},children:"Delivered"})]})]})]}),r&&t&&d.jsx(I,{sx:{width:32,height:32,fontSize:"0.875rem",bgcolor:"grey.300",color:"text.secondary"},children:"You"})]})}),nt=u.memo(function({messages:n,showResponseTime:t=!0,showAvatar:a=!0}){return n.length===0?d.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"column",gap:2,color:"text.secondary"},children:[d.jsx(C,{variant:"h6",children:"No messages yet"}),d.jsx(C,{variant:"body2",children:"Start a conversation!"})]}):d.jsx(S,{sx:{display:"flex",flexDirection:"column",p:2,height:"100%",overflow:"auto"},children:n.map(r=>d.jsx(Ke,{message:r,showAvatar:a,showResponseTime:t},r.id))})});export{nt as M,Ue as S,et as W,tt as u};
